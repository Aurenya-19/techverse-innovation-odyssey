<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TechVerse: Realistic City Simulator</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Segoe UI', Tahoma, sans-serif; overflow: hidden; background: #1a1a1a; color: #e0e0e0; }
#canvas { display: block; width: 100vw; height: 100vh; }

#charSelect { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: linear-gradient(180deg, #2c3e50 0%, #34495e 100%); display: flex; flex-direction: column; align-items: center; justify-content: flex-start; overflow-y: auto; padding: 20px; z-index: 10000; }
#charSelect h1 { font-size: clamp(2em, 4vw, 3em); color: #ecf0f1; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); margin: 20px 0; font-weight: 600; }
.subtitle { font-size: clamp(0.9em, 1.5vw, 1.1em); color: #bdc3c7; margin-bottom: 20px; text-align: center; }
.charGrid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; max-width: 1200px; width: 100%; padding: 10px; margin-bottom: 20px; }
.charCard { background: rgba(52, 73, 94, 0.8); border: 2px solid #7f8c8d; border-radius: 8px; padding: 15px; cursor: pointer; transition: all 0.3s; text-align: center; min-height: 160px; }
.charCard:hover { background: rgba(52, 73, 94, 1); transform: translateY(-3px); border-color: #95a5a6; }
.charCard.selected { background: rgba(46, 204, 113, 0.3); border-color: #27ae60; }
.charCard .icon { font-size: 2.5em; margin-bottom: 8px; }
.charCard h3 { color: #ecf0f1; font-size: 1.1em; margin: 8px 0; }
.charCard p { color: #95a5a6; font-size: 0.8em; line-height: 1.3; }
#startBtn { padding: 15px 50px; font-size: clamp(1em, 2vw, 1.3em); background: linear-gradient(135deg, #27ae60, #229954); border: none; border-radius: 6px; color: #fff; font-weight: 600; cursor: pointer; margin: 20px 0; text-transform: uppercase; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
#startBtn:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 6px 8px rgba(0,0,0,0.4); }
#startBtn:disabled { opacity: 0.4; cursor: not-allowed; }

#loading { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; background: rgba(44, 62, 80, 0.95); padding: 40px; border-radius: 10px; border: 2px solid #7f8c8d; z-index: 9999; }
#loading h2 { color: #ecf0f1; font-size: 1.8em; margin-bottom: 15px; }
.spinner { border: 4px solid rgba(127, 140, 141, 0.3); border-top: 4px solid #7f8c8d; border-radius: 50%; width: 60px; height: 60px; animation: spin 1s linear infinite; margin: 15px auto; }
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

#hud { position: fixed; top: 15px; left: 15px; background: rgba(44, 62, 80, 0.9); padding: 18px; border-radius: 6px; border: 1px solid #7f8c8d; min-width: 220px; z-index: 1000; }
#hud h3 { color: #ecf0f1; font-size: 1.1em; margin-bottom: 10px; border-bottom: 1px solid #7f8c8d; padding-bottom: 6px; }
.hudStat { display: flex; justify-content: space-between; margin: 6px 0; font-size: 0.9em; color: #bdc3c7; }
.hudStat .val { color: #27ae60; font-weight: 600; }

#inventory { position: fixed; top: 15px; right: 15px; background: rgba(44, 62, 80, 0.9); padding: 18px; border-radius: 6px; border: 1px solid #7f8c8d; max-width: 280px; max-height: 70vh; overflow-y: auto; z-index: 1000; }
#inventory h3 { color: #ecf0f1; font-size: 1.1em; margin-bottom: 10px; border-bottom: 1px solid #7f8c8d; padding-bottom: 6px; }
.invItem { background: rgba(52, 73, 94, 0.6); padding: 10px; margin: 8px 0; border-radius: 4px; border: 1px solid #7f8c8d; font-size: 0.9em; color: #bdc3c7; }

#interact { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: rgba(44, 62, 80, 0.95); padding: 25px 35px; border-radius: 8px; border: 2px solid #7f8c8d; max-width: 700px; width: 90%; text-align: center; z-index: 1000; }
#interact h4 { color: #ecf0f1; font-size: 1.6em; margin-bottom: 12px; }
#interact p { color: #bdc3c7; font-size: 1em; margin-bottom: 15px; line-height: 1.6; }
.actBtn { padding: 12px 28px; background: linear-gradient(135deg, #3498db, #2980b9); border: none; border-radius: 6px; color: #fff; font-weight: 600; cursor: pointer; margin: 6px; font-size: 1em; }
.actBtn:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.3); }

#controls { position: fixed; bottom: 20px; left: 20px; background: rgba(44, 62, 80, 0.9); padding: 15px; border-radius: 6px; border: 1px solid #7f8c8d; z-index: 1000; }
#controls h4 { color: #ecf0f1; margin-bottom: 8px; font-size: 1em; }
.ctrl { color: #bdc3c7; margin: 5px 0; font-size: 0.85em; }
.key { color: #27ae60; font-weight: 600; background: rgba(39, 174, 96, 0.2); padding: 2px 6px; border-radius: 3px; }

#notif { position: fixed; top: 100px; left: 50%; transform: translateX(-50%); background: rgba(39, 174, 96, 0.95); color: #fff; padding: 15px 35px; border-radius: 6px; font-weight: 600; font-size: 1.1em; opacity: 0; transition: opacity 0.3s; max-width: 85%; text-align: center; z-index: 2000; }
#notif.show { opacity: 1; }

.hide { display: none !important; }
</style>
</head>
<body>
<canvas id="canvas"></canvas>

<div id="charSelect">
  <h1>TechVerse: Realistic City Simulator</h1>
  <p class="subtitle">Experience a grounded, realistic tech city</p>
  <div class="charGrid">
    <div class="charCard" data-char="netrunner"><div class="icon">üíª</div><h3>Netrunner</h3><p>Cybersecurity specialist</p></div>
    <div class="charCard" data-char="bioengineer"><div class="icon">üß¨</div><h3>Bioengineer</h3><p>Genetic researcher</p></div>
    <div class="charCard" data-char="quantum"><div class="icon">‚öõÔ∏è</div><h3>Quantum Physicist</h3><p>Quantum computing expert</p></div>
    <div class="charCard" data-char="neurohacker"><div class="icon">üß†</div><h3>Neurohacker</h3><p>Neuroscience researcher</p></div>
    <div class="charCard" data-char="nanoengineer"><div class="icon">üî¨</div><h3>Nanoengineer</h3><p>Nanotechnology specialist</p></div>
    <div class="charCard" data-char="aiarchitect"><div class="icon">ü§ñ</div><h3>AI Architect</h3><p>Machine learning expert</p></div>
    <div class="charCard" data-char="spacesystems"><div class="icon">üöÄ</div><h3>Space Engineer</h3><p>Aerospace specialist</p></div>
    <div class="charCard" data-char="fusionengineer"><div class="icon">‚ö°</div><h3>Fusion Engineer</h3><p>Energy researcher</p></div>
  </div>
  <button id="startBtn" disabled>Select Character</button>
</div>

<div id="loading" class="hide">
  <h2>Loading City...</h2>
  <div class="spinner"></div>
  <p id="loadText">Initializing...</p>
</div>

<div id="hud" class="hide">
  <h3>STATUS</h3>
  <div class="hudStat"><span>Role:</span><span class="val" id="role">-</span></div>
  <div class="hudStat"><span>Level:</span><span class="val" id="lvl">1</span></div>
  <div class="hudStat"><span>XP:</span><span class="val" id="xp">0/100</span></div>
  <div class="hudStat"><span>Rep:</span><span class="val" id="rep">0</span></div>
  <div class="hudStat"><span>Credits:</span><span class="val" id="fund">$1M</span></div>
</div>

<div id="inventory" class="hide">
  <h3>INVENTORY</h3>
  <div id="invList"></div>
</div>

<div id="interact" class="hide">
  <h4 id="intTitle">Location</h4>
  <p id="intDesc">Description</p>
  <div id="intBtns"></div>
</div>

<div id="controls" class="hide">
  <h4>CONTROLS</h4>
  <div class="ctrl"><span class="key">WASD</span> Move</div>
  <div class="ctrl"><span class="key">MOUSE</span> Look</div>
  <div class="ctrl"><span class="key">E</span> Interact</div>
  <div class="ctrl"><span class="key">SHIFT</span> Sprint</div>
</div>

<div id="notif"></div>

<script type="importmap">{"imports":{"three":"https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js"}}</script>
<script type="module">
import * as THREE from 'three';

const state = {
  char: null, lvl: 1, xp: 0, xpMax: 100, rep: 0, fund: 1000000,
  inventory: [], currentLocation: null
};

const locations = {
  quantum: { name: 'Quantum Research Lab', pos: [-100, 0, -120], color: 0x5a6c7d, size: 35, height: 65 },
  bio: { name: 'Biotech Center', pos: [100, 0, -120], color: 0x6b8e7f, size: 35, height: 60 },
  ai: { name: 'AI Research Institute', pos: [-100, 0, 120], color: 0x7d6b5a, size: 35, height: 63 },
  space: { name: 'Space Systems Lab', pos: [0, 0, -150], color: 0x5a7d8e, size: 40, height: 80 },
  hybrid: { name: 'Innovation Center', pos: [0, 0, 0], color: 0x6d7d8e, size: 50, height: 85 },
  arena: { name: 'Tech Arena', pos: [-80, 0, 50], color: 0x8e6d5a, size: 45, height: 68 },
  store: { name: 'Tech Store', pos: [50, 0, 80], color: 0x7d7d8e, size: 28, height: 42 }
};

let scene, camera, renderer, buildings = [], npcs = [], cars = [], curInteract = null;
let moveF = false, moveB = false, moveL = false, moveR = false, sprint = false;
const vel = new THREE.Vector3(), dir = new THREE.Vector3(), clock = new THREE.Clock();

function init() {
  scene = new THREE.Scene();
  
  // REALISTIC SKY - Natural blue, not cartoon
  scene.background = new THREE.Color(0x87CEEB); // Sky blue
  scene.fog = new THREE.Fog(0x87CEEB, 100, 800); // Atmospheric fog

  camera = new THREE.PerspectiveCamera(75, innerWidth / innerHeight, 0.1, 1000);
  camera.position.set(0, 5, 30);

  renderer = new THREE.WebGLRenderer({ 
    canvas: document.getElementById('canvas'), 
    antialias: true
  });
  renderer.setSize(innerWidth, innerHeight);
  renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
  renderer.shadowMap.enabled = true;
  renderer.shadowMap.type = THREE.PCFSoftShadowMap;

  // NATURAL LIGHTING - Like real sunlight
  const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
  scene.add(ambientLight);

  const sun = new THREE.DirectionalLight(0xffffff, 1.2);
  sun.position.set(200, 400, 200);
  sun.castShadow = true;
  sun.shadow.mapSize.width = 2048;
  sun.shadow.mapSize.height = 2048;
  sun.shadow.camera.far = 1000;
  scene.add(sun);

  // Subtle hemisphere light for natural sky lighting
  const hemiLight = new THREE.HemisphereLight(0x87CEEB, 0x545454, 0.4);
  scene.add(hemiLight);

  // Subtle city lights - not bright neon
  const lightPositions = [
    [-100, 20, -120], [100, 20, -120], [-100, 20, 120],
    [0, 25, -150], [0, 30, 0], [-80, 22, 50], [50, 18, 80]
  ];
  
  lightPositions.forEach(pos => {
    const light = new THREE.PointLight(0xffd699, 0.8, 100);
    light.position.set(...pos);
    scene.add(light);
  });

  createRealisticWorld();
  createRealisticNPCs();
  createRealisticCars();
  setupControls();
  animate();
  updateHUD();
  updateInv();

  notify('Welcome to TechVerse! Explore the realistic city.');
}

function createRealisticWorld() {
  // REALISTIC GROUND - Natural grass color
  const groundGeo = new THREE.PlaneGeometry(1500, 1500);
  const groundMat = new THREE.MeshStandardMaterial({ 
    color: 0x3d5a3d, // Natural grass green
    roughness: 0.9,
    metalness: 0
  });
  
  const ground = new THREE.Mesh(groundGeo, groundMat);
  ground.rotation.x = -Math.PI / 2;
  ground.receiveShadow = true;
  scene.add(ground);

  // REALISTIC ROADS - Asphalt gray
  for (let i = -350; i <= 350; i += 70) {
    createRoad(i, 0, 0, 1500, 14);
    createRoad(0, 0, i, 14, 1500);
  }

  // Road markings - subtle yellow
  const gridHelper = new THREE.GridHelper(1500, 300, 0xcccc99, 0x444444);
  gridHelper.position.y = 0.1;
  scene.add(gridHelper);

  // Create buildings with REALISTIC colors
  Object.entries(locations).forEach(([id, loc]) => {
    createBuilding(loc.pos[0], loc.pos[1], loc.pos[2], loc.size, loc.height, loc.size, loc.color, loc.name, id);
  });

  // Extra buildings - muted realistic colors
  const buildingColors = [0x6d7d8e, 0x7d6d5a, 0x5a6c7d, 0x6b8e7f, 0x8e7d6d, 0x7d8e8e];
  for (let i = 0; i < 80; i++) {
    const x = (Math.random() - 0.5) * 650;
    const z = (Math.random() - 0.5) * 650;
    const w = 18 + Math.random() * 25;
    const h = 35 + Math.random() * 70;
    const color = buildingColors[Math.floor(Math.random() * buildingColors.length)];
    createSimpleBuilding(x, 0, z, w, h, w, color);
  }
}

function createRoad(x, y, z, w, d) {
  const roadGeo = new THREE.PlaneGeometry(w, d);
  const roadMat = new THREE.MeshStandardMaterial({ 
    color: 0x3a3a3a, // Asphalt gray
    roughness: 0.95,
    metalness: 0
  });
  const road = new THREE.Mesh(roadGeo, roadMat);
  road.rotation.x = -Math.PI / 2;
  road.position.set(x, y + 0.1, z);
  road.receiveShadow = true;
  scene.add(road);
}

function createBuilding(x, y, z, w, h, d, color, name, id) {
  const bldgGeo = new THREE.BoxGeometry(w, h, d);
  const bldgMat = new THREE.MeshStandardMaterial({
    color,
    roughness: 0.7,
    metalness: 0.3
  });
  
  const bldg = new THREE.Mesh(bldgGeo, bldgMat);
  bldg.position.set(x, h / 2, z);
  bldg.castShadow = true;
  bldg.receiveShadow = true;
  bldg.userData = { type: 'building', id, name };
  scene.add(bldg);
  buildings.push(bldg);

  // Windows - subtle glow
  for (let i = 0; i < 12; i++) {
    const windowGeo = new THREE.PlaneGeometry(w * 0.7, h / 14);
    const windowMat = new THREE.MeshStandardMaterial({ 
      color: 0xffd699,
      emissive: 0xffd699,
      emissiveIntensity: 0.3,
      transparent: true,
      opacity: 0.7
    });
    const window = new THREE.Mesh(windowGeo, windowMat);
    window.position.set(0, -h / 2 + (i + 1) * (h / 13), d / 2 + 0.1);
    bldg.add(window);
  }

  // Entrance
  const entranceGeo = new THREE.BoxGeometry(10, 15, 2);
  const entranceMat = new THREE.MeshStandardMaterial({ 
    color: 0x8e8e8e,
    roughness: 0.5,
    metalness: 0.5
  });
  const entrance = new THREE.Mesh(entranceGeo, entranceMat);
  entrance.position.set(0, 7.5, d / 2 + 1);
  bldg.add(entrance);

  createLabel(name, x, h + 12, z);
}

function createSimpleBuilding(x, y, z, w, h, d, color) {
  const bldgGeo = new THREE.BoxGeometry(w, h, d);
  const bldgMat = new THREE.MeshStandardMaterial({ 
    color,
    roughness: 0.7,
    metalness: 0.3
  });
  
  const bldg = new THREE.Mesh(bldgGeo, bldgMat);
  bldg.position.set(x, h / 2, z);
  bldg.castShadow = true;
  bldg.receiveShadow = true;
  scene.add(bldg);
}

function createLabel(text, x, y, z) {
  const canvas = document.createElement('canvas');
  const ctx = canvas.getContext('2d');
  canvas.width = 512;
  canvas.height = 128;
  
  ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
  ctx.fillRect(0, 0, 512, 128);
  ctx.font = 'Bold 48px Arial';
  ctx.fillStyle = '#ecf0f1';
  ctx.textAlign = 'center';
  ctx.fillText(text, 256, 70);
  
  const texture = new THREE.CanvasTexture(canvas);
  const sprite = new THREE.Sprite(new THREE.SpriteMaterial({ map: texture }));
  sprite.position.set(x, y, z);
  sprite.scale.set(25, 6.25, 1);
  scene.add(sprite);
}

function createRealisticNPCs() {
  for (let i = 0; i < 40; i++) {
    const x = (Math.random() - 0.5) * 600;
    const z = (Math.random() - 0.5) * 600;
    
    const npcGeo = new THREE.CapsuleGeometry(1.2, 3.5, 8, 16);
    const npcMat = new THREE.MeshStandardMaterial({ 
      color: 0x4a5568, // Muted gray-blue
      roughness: 0.8,
      metalness: 0.2
    });
    
    const npc = new THREE.Mesh(npcGeo, npcMat);
    npc.position.set(x, 2.5, z);
    npc.castShadow = true;
    npc.userData = {
      speed: 0.7 + Math.random() * 0.6,
      direction: Math.random() * Math.PI * 2,
      walkTime: 0
    };
    scene.add(npc);
    npcs.push(npc);
  }
}

function createRealisticCars() {
  const carColors = [0x1a1a1a, 0x2c3e50, 0x34495e, 0x7f8c8d, 0x95a5a6, 0xecf0f1];
  for (let i = 0; i < 30; i++) {
    const x = (Math.random() - 0.5) * 600;
    const y = 25 + Math.random() * 30;
    const z = (Math.random() - 0.5) * 600;
    
    const carGeo = new THREE.BoxGeometry(6, 3, 9);
    const carMat = new THREE.MeshStandardMaterial({ 
      color: carColors[i % carColors.length],
      roughness: 0.3,
      metalness: 0.7
    });
    
    const car = new THREE.Mesh(carGeo, carMat);
    car.position.set(x, y, z);
    car.castShadow = true;
    car.userData = {
      speed: 2 + Math.random() * 2.5,
      direction: Math.random() * Math.PI * 2,
      height: y
    };
    scene.add(car);
    cars.push(car);
  }
}

function setupControls() {
  addEventListener('resize', () => {
    camera.aspect = innerWidth / innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(innerWidth, innerHeight);
  });

  addEventListener('keydown', e => {
    if (e.code === 'KeyW') moveF = true;
    if (e.code === 'KeyS') moveB = true;
    if (e.code === 'KeyA') moveL = true;
    if (e.code === 'KeyD') moveR = true;
    if (e.code === 'ShiftLeft') sprint = true;
    if (e.code === 'KeyE' && curInteract) interact();
  });

  addEventListener('keyup', e => {
    if (e.code === 'KeyW') moveF = false;
    if (e.code === 'KeyS') moveB = false;
    if (e.code === 'KeyA') moveL = false;
    if (e.code === 'KeyD') moveR = false;
    if (e.code === 'ShiftLeft') sprint = false;
  });

  addEventListener('mousemove', e => {
    if (document.pointerLockElement === document.body) {
      camera.rotation.y -= (e.movementX || 0) * 0.002;
      camera.rotation.x -= (e.movementY || 0) * 0.002;
      camera.rotation.x = Math.max(-Math.PI / 2, Math.min(Math.PI / 2, camera.rotation.x));
    }
  });

  document.body.addEventListener('click', () => {
    if (!document.getElementById('charSelect').classList.contains('hide')) return;
    document.body.requestPointerLock();
  });
}

function animate() {
  requestAnimationFrame(animate);
  const delta = clock.getDelta();
  const speed = sprint ? 100 : 70;

  vel.x -= vel.x * 10 * delta;
  vel.z -= vel.z * 10 * delta;
  dir.z = Number(moveF) - Number(moveB);
  dir.x = Number(moveR) - Number(moveL);
  dir.normalize();

  if (moveF || moveB) vel.z -= dir.z * speed * delta;
  if (moveL || moveR) vel.x -= dir.x * speed * delta;

  camera.position.x += vel.x * delta;
  camera.position.z += vel.z * delta;

  npcs.forEach(npc => {
    npc.userData.walkTime += delta;
    if (npc.userData.walkTime > 5) {
      npc.userData.direction = Math.random() * Math.PI * 2;
      npc.userData.walkTime = 0;
    }
    
    const speed = npc.userData.speed;
    npc.position.x += Math.sin(npc.userData.direction) * speed * delta;
    npc.position.z += Math.cos(npc.userData.direction) * speed * delta;
    npc.position.x = Math.max(-300, Math.min(300, npc.position.x));
    npc.position.z = Math.max(-300, Math.min(300, npc.position.z));
    npc.rotation.y = npc.userData.direction;
    npc.position.y = 2.5 + Math.sin(Date.now() * 0.005 + npc.position.x) * 0.3;
  });

  cars.forEach(car => {
    const speed = car.userData.speed;
    car.position.x += Math.sin(car.userData.direction) * speed * delta;
    car.position.z += Math.cos(car.userData.direction) * speed * delta;
    
    if (car.position.x > 350) car.position.x = -350;
    if (car.position.x < -350) car.position.x = 350;
    if (car.position.z > 350) car.position.z = -350;
    if (car.position.z < -350) car.position.z = 350;
    
    car.position.y = car.userData.height + Math.sin(Date.now() * 0.002 + car.position.x) * 2;
    car.rotation.y = car.userData.direction;
  });

  checkNearby();
  renderer.render(scene, camera);
}

function checkNearby() {
  let nearest = null, minDist = 30;
  
  buildings.forEach(bldg => {
    const dist = camera.position.distanceTo(bldg.position);
    if (dist < minDist) { minDist = dist; nearest = bldg; }
  });

  if (nearest && nearest !== curInteract) { curInteract = nearest; showInteract(); }
  else if (!nearest && curInteract) { curInteract = null; hideInteract(); }
}

function showInteract() {
  document.getElementById('intTitle').textContent = curInteract.userData.name;
  document.getElementById('intDesc').textContent = 'Press E to enter this facility.';
  
  const btns = document.getElementById('intBtns');
  btns.innerHTML = '<button class="actBtn" onclick="window.enterBuilding()">ENTER</button><button class="actBtn" onclick="window.hideInteract()">CANCEL</button>';
  
  document.getElementById('interact').classList.remove('hide');
}

function hideInteract() {
  document.getElementById('interact').classList.add('hide');
}

function interact() {
  notify('Entered ' + curInteract.userData.name);
  hideInteract();
}

window.enterBuilding = interact;
window.hideInteract = hideInteract;

function updateHUD() {
  document.getElementById('role').textContent = state.char || '-';
  document.getElementById('lvl').textContent = state.lvl;
  document.getElementById('xp').textContent = `${state.xp}/${state.xpMax}`;
  document.getElementById('rep').textContent = state.rep;
  document.getElementById('fund').textContent = '$' + (state.fund / 1000).toFixed(0) + 'K';
}

function updateInv() {
  const list = document.getElementById('invList');
  list.innerHTML = state.inventory.length === 0 ? '<p style="color:#95a5a6;text-align:center;padding:20px">No items</p>' : '';
  
  state.inventory.forEach(item => {
    const div = document.createElement('div');
    div.className = 'invItem';
    div.textContent = item;
    list.appendChild(div);
  });
}

function notify(msg) {
  const n = document.getElementById('notif');
  n.textContent = msg;
  n.classList.add('show');
  setTimeout(() => n.classList.remove('show'), 3500);
}

let selChar = null;
document.querySelectorAll('.charCard').forEach(card => {
  card.addEventListener('click', () => {
    document.querySelectorAll('.charCard').forEach(c => c.classList.remove('selected'));
    card.classList.add('selected');
    selChar = card.dataset.char;
    document.getElementById('startBtn').disabled = false;
    document.getElementById('startBtn').textContent = 'START';
  });
});

document.getElementById('startBtn').addEventListener('click', () => {
  if (!selChar) return;
  state.char = selChar;
  document.getElementById('charSelect').classList.add('hide');
  document.getElementById('loading').classList.remove('hide');
  
  const msgs = ['Loading environment...', 'Building city...', 'Spawning NPCs...', 'Adding vehicles...', 'Ready!'];
  let i = 0;
  const interval = setInterval(() => {
    document.getElementById('loadText').textContent = msgs[i++];
    if (i >= msgs.length) {
      clearInterval(interval);
      document.getElementById('loading').classList.add('hide');
      document.getElementById('hud').classList.remove('hide');
      document.getElementById('inventory').classList.remove('hide');
      document.getElementById('controls').classList.remove('hide');
      init();
    }
  }, 600);
});
</script>
</body>
</html>