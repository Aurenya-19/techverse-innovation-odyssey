<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TechVerse: Innovation Odyssey</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
body { overflow: hidden; background: #000; }
#canvas { display: block; width: 100vw; height: 100vh; }
.ui-layer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1000; }
#char-select { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(10, 10, 30, 0.98); padding: 40px; border-radius: 20px; border: 3px solid #0ff; box-shadow: 0 0 60px rgba(0, 255, 255, 0.8); pointer-events: all; max-width: 1100px; width: 95%; max-height: 90vh; overflow-y: auto; }
h1 { color: #0ff; text-align: center; margin-bottom: 15px; font-size: 2.5em; text-shadow: 0 0 30px #0ff; animation: glow 2s ease-in-out infinite; }
@keyframes glow { 0%, 100% { text-shadow: 0 0 20px #0ff; } 50% { text-shadow: 0 0 40px #0ff, 0 0 60px #0ff; } }
.subtitle { color: #888; text-align: center; margin-bottom: 25px; font-size: 1.1em; }
.char-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 25px; }
.char-card { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); padding: 20px; border-radius: 15px; border: 2px solid #444; cursor: pointer; transition: all 0.3s; text-align: center; }
.char-card:hover { border-color: #0ff; transform: translateY(-5px) scale(1.02); box-shadow: 0 10px 30px rgba(0, 255, 255, 0.4); }
.char-card.selected { border-color: #0f0; background: linear-gradient(135deg, #1a2e1a 0%, #16213e 100%); box-shadow: 0 0 40px rgba(0, 255, 0, 0.6); }
.char-card h3 { color: #0ff; margin: 10px 0; font-size: 1.2em; }
.char-card p { color: #aaa; font-size: 0.9em; line-height: 1.5; }
.char-icon { font-size: 3em; margin-bottom: 10px; }
#start-btn { width: 100%; padding: 18px; background: linear-gradient(135deg, #0ff, #0f0); border: none; border-radius: 12px; color: #000; font-size: 1.3em; font-weight: bold; cursor: pointer; text-transform: uppercase; letter-spacing: 3px; transition: all 0.3s; }
#start-btn:hover:not(:disabled) { transform: scale(1.05); box-shadow: 0 10px 40px rgba(0, 255, 255, 0.6); }
#start-btn:disabled { opacity: 0.5; cursor: not-allowed; }
#hud { position: fixed; top: 20px; left: 20px; background: rgba(10, 10, 30, 0.95); padding: 20px; border-radius: 12px; border: 2px solid #0ff; pointer-events: all; min-width: 250px; backdrop-filter: blur(10px); }
#hud h3 { color: #0ff; margin-bottom: 12px; font-size: 1.2em; border-bottom: 2px solid #0ff; padding-bottom: 8px; }
.hud-item { color: #aaa; margin: 8px 0; font-size: 0.95em; display: flex; justify-content: space-between; }
.hud-value { color: #0f0; font-weight: bold; }
#tech-panel { position: fixed; top: 20px; right: 20px; background: rgba(10, 10, 30, 0.95); padding: 20px; border-radius: 12px; border: 2px solid #f80; pointer-events: all; max-width: 350px; max-height: 80vh; overflow-y: auto; backdrop-filter: blur(10px); }
#tech-panel h3 { color: #f80; margin-bottom: 12px; font-size: 1.2em; border-bottom: 2px solid #f80; padding-bottom: 8px; }
.tech-item { background: rgba(255, 136, 0, 0.15); padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid #f80; cursor: pointer; transition: all 0.3s; }
.tech-item:hover { background: rgba(255, 136, 0, 0.3); transform: translateX(5px); }
.tech-item.unlocked { border-color: #0f0; background: rgba(0, 255, 0, 0.15); }
.tech-name { color: #0ff; font-weight: bold; margin-bottom: 5px; font-size: 1em; }
.tech-desc { color: #888; font-size: 0.85em; margin-bottom: 5px; }
.tech-cost { color: #f80; font-size: 0.9em; font-weight: bold; }
#interact-panel { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: rgba(10, 10, 30, 0.98); padding: 25px 35px; border-radius: 15px; border: 3px solid #0ff; pointer-events: all; max-width: 700px; text-align: center; backdrop-filter: blur(10px); box-shadow: 0 0 40px rgba(0, 255, 255, 0.5); }
#interact-panel h4 { color: #0ff; margin-bottom: 10px; font-size: 1.4em; }
#interact-panel p { color: #aaa; margin-bottom: 15px; font-size: 1em; line-height: 1.6; }
.action-btn { padding: 12px 25px; background: linear-gradient(135deg, #0ff, #08f); border: none; border-radius: 10px; color: #000; font-weight: bold; cursor: pointer; margin: 5px; font-size: 1em; transition: all 0.3s; }
.action-btn:hover { transform: scale(1.1); box-shadow: 0 5px 20px rgba(0, 255, 255, 0.6); }
#notification { position: fixed; top: 100px; left: 50%; transform: translateX(-50%); background: rgba(0, 255, 0, 0.95); color: #000; padding: 15px 30px; border-radius: 12px; font-weight: bold; font-size: 1.1em; opacity: 0; transition: opacity 0.3s; pointer-events: none; max-width: 80%; text-align: center; box-shadow: 0 5px 20px rgba(0, 255, 0, 0.5); }
#notification.show { opacity: 1; }
.hidden { display: none !important; }
#controls { position: fixed; bottom: 20px; right: 20px; background: rgba(10, 10, 30, 0.9); padding: 15px; border-radius: 10px; border: 2px solid #0ff; pointer-events: all; font-size: 0.9em; }
#controls h4 { color: #0ff; margin-bottom: 8px; }
.control-item { color: #aaa; margin: 5px 0; }
.key { color: #0f0; font-weight: bold; background: rgba(0, 255, 0, 0.1); padding: 2px 6px; border-radius: 4px; }
#loading { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #0ff; font-size: 1.5em; text-align: center; }
.spinner { border: 4px solid rgba(0, 255, 255, 0.3); border-top: 4px solid #0ff; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin: 20px auto; }
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
@media (max-width: 1024px) { .char-grid { grid-template-columns: repeat(2, 1fr); } }
@media (max-width: 640px) { .char-grid { grid-template-columns: 1fr; } #hud, #tech-panel { position: relative; margin: 10px; max-height: none; } }
</style>
</head>
<body>
<canvas id="canvas"></canvas>
<div class="ui-layer">
<div id="loading">
<div class="spinner"></div>
<p>Loading TechVerse...</p>
</div>
<div id="char-select" class="hidden">
<h1>üöÄ TechVerse: Innovation Odyssey</h1>
<p class="subtitle">Choose your character and explore cutting-edge technologies</p>
<div class="char-grid">
<div class="char-card" data-char="netrunner">
<div class="char-icon">üíª</div>
<h3>Netrunner</h3>
<p>Elite hacker and VR specialist. Master of digital realms and code.</p>
</div>
<div class="char-card" data-char="bioengineer">
<div class="char-icon">üß¨</div>
<h3>Bioengineer</h3>
<p>Gene editing expert. Design life at the molecular level.</p>
</div>
<div class="char-card" data-char="quantum">
<div class="char-icon">‚öõÔ∏è</div>
<h3>Quantum Physicist</h3>
<p>Quantum computing architect. Bend reality with qubits.</p>
</div>
<div class="char-card" data-char="neurohacker">
<div class="char-icon">üß†</div>
<h3>Neurohacker</h3>
<p>Brain-machine interface specialist. Connect minds to machines.</p>
</div>
<div class="char-card" data-char="nanoengineer">
<div class="char-icon">üî¨</div>
<h3>Nanoengineer</h3>
<p>Molecular fabrication expert. Build at atomic scale.</p>
</div>
<div class="char-card" data-char="aiarchitect">
<div class="char-icon">ü§ñ</div>
<h3>AI Architect</h3>
<p>Artificial intelligence designer. Create synthetic minds.</p>
</div>
<div class="char-card" data-char="spacesystems">
<div class="char-icon">üöÄ</div>
<h3>Space Engineer</h3>
<p>Orbital systems specialist. Build the future in space.</p>
</div>
<div class="char-card" data-char="fusionengineer">
<div class="char-icon">‚ö°</div>
<h3>Fusion Engineer</h3>
<p>Clean energy pioneer. Harness the power of stars.</p>
</div>
</div>
<button id="start-btn" disabled>Select a Character to Begin</button>
</div>
<div id="hud" class="hidden">
<h3>‚ö° Status</h3>
<div class="hud-item"><span>Character:</span><span class="hud-value" id="char-name">-</span></div>
<div class="hud-item"><span>Level:</span><span class="hud-value" id="level">1</span></div>
<div class="hud-item"><span>XP:</span><span class="hud-value" id="xp">0/100</span></div>
<div class="hud-item"><span>Reputation:</span><span class="hud-value" id="rep">0</span></div>
<div class="hud-item"><span>Funding:</span><span class="hud-value" id="funding">$100,000</span></div>
<div class="hud-item"><span>Tech Unlocked:</span><span class="hud-value" id="tech-count">0</span></div>
</div>
<div id="tech-panel" class="hidden">
<h3>üîß Available Technologies</h3>
<div id="tech-list"></div>
</div>
<div id="interact-panel" class="hidden">
<h4 id="interact-title">Technology</h4>
<p id="interact-desc">Description</p>
<div id="interact-buttons"></div>
</div>
<div id="controls" class="hidden">
<h4>Controls</h4>
<div class="control-item"><span class="key">W A S D</span> Move</div>
<div class="control-item"><span class="key">Mouse</span> Look</div>
<div class="control-item"><span class="key">E</span> Interact</div>
<div class="control-item"><span class="key">Click</span> Lock cursor</div>
</div>
<div id="notification"></div>
</div>
<script type="importmap">
{
  "imports": {
    "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js"
  }
}
</script>
<script type="module">
import * as THREE from 'three';

// Game State
const gameState = {
  character: null,
  level: 1,
  xp: 0,
  xpMax: 100,
  reputation: 0,
  funding: 100000,
  techUnlocked: []
};

// Technologies with real-world basis
const technologies = {
  vr: { name: 'VR Headset', cost: 8000, desc: 'Full immersion virtual reality system', category: 'Hardware', unlocked: false, color: 0x00ffff },
  quantum: { name: 'Quantum Computer', cost: 75000, desc: 'Google Willow-class quantum processor with error correction', category: 'Computing', unlocked: false, color: 0xff00ff },
  neural: { name: 'Neural Interface', cost: 120000, desc: 'Bidirectional brain-computer interface (BCI)', category: 'Biotech', unlocked: false, color: 0x00ff00 },
  ar: { name: 'AR Glasses', cost: 12000, desc: 'Mixed reality holographic display system', category: 'Hardware', unlocked: false, color: 0xffff00 },
  nanobot: { name: 'Nanobots', cost: 150000, desc: 'Programmable molecular machines for fabrication', category: 'Nanotech', unlocked: false, color: 0xff8800 },
  fusion: { name: 'Fusion Reactor', cost: 300000, desc: 'Compact tokamak with high-temperature superconducting magnets', category: 'Energy', unlocked: false, color: 0xff4400 },
  ai: { name: 'AGI Core', cost: 50000, desc: 'Artificial General Intelligence system', category: 'AI', unlocked: false, color: 0xff0088 },
  crispr: { name: 'CRISPR Lab', cost: 90000, desc: 'Advanced gene editing suite with base editors', category: 'Biotech', unlocked: false, color: 0x00ff88 },
  hologram: { name: 'Holographic Display', cost: 25000, desc: 'Volumetric 3D light field projection', category: 'Display', unlocked: false, color: 0x00ffff },
  drone: { name: 'Swarm Drones', cost: 35000, desc: 'Autonomous drone network with AI coordination', category: 'Robotics', unlocked: false, color: 0x0088ff },
  satellite: { name: 'CubeSat Network', cost: 200000, desc: 'Personal satellite constellation for global coverage', category: 'Space', unlocked: false, color: 0x4400ff },
  bioprinter: { name: '3D Bioprinter', cost: 110000, desc: 'Organ and tissue fabrication system', category: 'Biotech', unlocked: false, color: 0x88ff00 }
};

// Three.js variables
let scene, camera, renderer, raycaster, mouse;
let techObjects = [];
let currentInteractable = null;
let moveForward = false, moveBackward = false, moveLeft = false, moveRight = false;
const velocity = new THREE.Vector3();
const direction = new THREE.Vector3();
const clock = new THREE.Clock();

// Initialize Three.js scene
function initScene() {
  // Scene setup
  scene = new THREE.Scene();
  scene.background = new THREE.Color(0x000510);
  scene.fog = new THREE.Fog(0x000510, 50, 300);

  // Camera
  camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
  camera.position.set(0, 2, 10);

  // Renderer
  renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('canvas'), antialias: true });
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.shadowMap.enabled = true;
  renderer.shadowMap.type = THREE.PCFSoftShadowMap;

  // Raycaster for interaction
  raycaster = new THREE.Raycaster();
  mouse = new THREE.Vector2();

  // Lighting
  const ambientLight = new THREE.AmbientLight(0x404060, 0.5);
  scene.add(ambientLight);

  const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
  directionalLight.position.set(50, 100, 50);
  directionalLight.castShadow = true;
  directionalLight.shadow.mapSize.width = 2048;
  directionalLight.shadow.mapSize.height = 2048;
  scene.add(directionalLight);

  // Neon lights
  addNeonLight(-20, 8, -20, 0x00ffff);
  addNeonLight(20, 8, -20, 0xff00ff);
  addNeonLight(0, 8, 30, 0x00ff00);
  addNeonLight(-30, 8, 10, 0xff8800);
  addNeonLight(30, 8, 10, 0x0088ff);

  // Create environment
  createGround();
  createBuildings();
  createStarfield();
  createTechStations();

  // Event listeners
  window.addEventListener('resize', onWindowResize);
  document.addEventListener('keydown', onKeyDown);
  document.addEventListener('keyup', onKeyUp);
  document.addEventListener('mousemove', onMouseMove);
  document.body.addEventListener('click', () => {
    document.body.requestPointerLock();
  });

  // Hide loading, show game
  document.getElementById('loading').classList.add('hidden');
  document.getElementById('char-select').classList.remove('hidden');

  animate();
}

function addNeonLight(x, y, z, color) {
  const light = new THREE.PointLight(color, 1.5, 60);
  light.position.set(x, y, z);
  scene.add(light);
  
  // Add glow sphere
  const glowGeometry = new THREE.SphereGeometry(0.5, 16, 16);
  const glowMaterial = new THREE.MeshBasicMaterial({ color: color });
  const glowSphere = new THREE.Mesh(glowGeometry, glowMaterial);
  glowSphere.position.set(x, y, z);
  scene.add(glowSphere);
}

function createGround() {
  const groundGeometry = new THREE.PlaneGeometry(300, 300);
  const groundMaterial = new THREE.MeshStandardMaterial({
    color: 0x0a0a1e,
    roughness: 0.9,
    metalness: 0.1
  });
  const ground = new THREE.Mesh(groundGeometry, groundMaterial);
  ground.rotation.x = -Math.PI / 2;
  ground.receiveShadow = true;
  scene.add(ground);

  // Grid
  const gridHelper = new THREE.GridHelper(300, 60, 0x00ffff, 0x003344);
  scene.add(gridHelper);
}

function createBuildings() {
  // Main buildings with labels
  createBuilding(-30, 0, -40, 15, 30, 15, 0x16213e, 'QUANTUM LAB');
  createBuilding(30, 0, -40, 15, 35, 15, 0x1a1a2e, 'AI RESEARCH CENTER');
  createBuilding(-40, 0, 20, 20, 20, 20, 0x0f3460, 'BIOTECH HUB');
  createBuilding(40, 0, 20, 18, 25, 18, 0x16213e, 'NANOTECH FACILITY');
  createBuilding(0, 0, 45, 25, 18, 25, 0x1a2e1a, 'YOUR TECH HOME');
  createBuilding(-55, 0, 0, 12, 40, 12, 0x2e1a1a, 'FUSION PLANT');
  createBuilding(55, 0, 0, 12, 32, 12, 0x1a1a3e, 'SPACE PORT');
}

function createBuilding(x, y, z, width, height, depth, color, label) {
  const geometry = new THREE.BoxGeometry(width, height, depth);
  const material = new THREE.MeshStandardMaterial({
    color: color,
    roughness: 0.6,
    metalness: 0.4,
    emissive: 0x00ffff,
    emissiveIntensity: 0.2
  });
  const building = new THREE.Mesh(geometry, material);
  building.position.set(x, height / 2, z);
  building.castShadow = true;
  building.receiveShadow = true;
  scene.add(building);

  // Glowing edges
  const edges = new THREE.EdgesGeometry(geometry);
  const lineMaterial = new THREE.LineBasicMaterial({ color: 0x00ffff, linewidth: 2 });
  const wireframe = new THREE.LineSegments(edges, lineMaterial);
  building.add(wireframe);

  // Label
  createLabel(label, x, height + 3, z);
}

function createLabel(text, x, y, z) {
  const canvas = document.createElement('canvas');
  const context = canvas.getContext('2d');
  canvas.width = 512;
  canvas.height = 128;
  
  context.fillStyle = 'rgba(0, 0, 0, 0.8)';
  context.fillRect(0, 0, canvas.width, canvas.height);
  
  context.font = 'Bold 36px Arial';
  context.fillStyle = '#00ffff';
  context.textAlign = 'center';
  context.textBaseline = 'middle';
  context.fillText(text, canvas.width / 2, canvas.height / 2);
  
  const texture = new THREE.CanvasTexture(canvas);
  const spriteMaterial = new THREE.SpriteMaterial({ map: texture });
  const sprite = new THREE.Sprite(spriteMaterial);
  sprite.position.set(x, y, z);
  sprite.scale.set(12, 3, 1);
  scene.add(sprite);
}

function createStarfield() {
  const starsGeometry = new THREE.BufferGeometry();
  const starVertices = [];
  
  for (let i = 0; i < 20000; i++) {
    const x = (Math.random() - 0.5) * 3000;
    const y = Math.random() * 1500;
    const z = (Math.random() - 0.5) * 3000;
    starVertices.push(x, y, z);
  }
  
  starsGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starVertices, 3));
  const starsMaterial = new THREE.PointsMaterial({
    color: 0xffffff,
    size: 0.7,
    transparent: true,
    opacity: 0.8
  });
  const stars = new THREE.Points(starsGeometry, starsMaterial);
  scene.add(stars);
}

function createTechStations() {
  const positions = [
    { x: -20, z: -35, tech: 'vr' },
    { x: 20, z: -35, tech: 'quantum' },
    { x: -35, z: 15, tech: 'neural' },
    { x: 35, z: 15, tech: 'ar' },
    { x: 0, z: 38, tech: 'hologram' },
    { x: -50, z: 0, tech: 'fusion' },
    { x: 50, z: 0, tech: 'satellite' },
    { x: -12, z: -20, tech: 'ai' },
    { x: 12, z: -20, tech: 'crispr' },
    { x: -25, z: 8, tech: 'nanobot' },
    { x: 25, z: 8, tech: 'drone' },
    { x: 0, z: 25, tech: 'bioprinter' }
  ];

  positions.forEach(pos => {
    createTechStation(pos.x, pos.z, pos.tech);
  });
}

function createTechStation(x, z, techId) {
  const tech = technologies[techId];
  const y = 2;

  // Platform
  const platformGeometry = new THREE.CylinderGeometry(3, 3, 0.5, 32);
  const platformMaterial = new THREE.MeshStandardMaterial({
    color: 0x1a1a2e,
    emissive: tech.color,
    emissiveIntensity: 0.3,
    metalness: 0.8,
    roughness: 0.2
  });
  const platform = new THREE.Mesh(platformGeometry, platformMaterial);
  platform.position.set(x, 0.25, z);
  platform.receiveShadow = true;
  scene.add(platform);

  // Tech cube
  const cubeGeometry = new THREE.BoxGeometry(3, 3, 3);
  const cubeMaterial = new THREE.MeshStandardMaterial({
    color: tech.color,
    emissive: tech.color,
    emissiveIntensity: 0.7,
    metalness: 0.9,
    roughness: 0.1,
    transparent: true,
    opacity: 0.9
  });
  const cube = new THREE.Mesh(cubeGeometry, cubeMaterial);
  cube.position.set(x, y, z);
  cube.castShadow = true;
  cube.userData = { techId: techId, originalY: y, floatSpeed: Math.random() * 0.5 + 0.5 };
  scene.add(cube);
  techObjects.push(cube);

  // Glow effect
  const glowGeometry = new THREE.SphereGeometry(2.2, 32, 32);
  const glowMaterial = new THREE.MeshBasicMaterial({
    color: tech.color,
    transparent: true,
    opacity: 0.2
  });
  const glow = new THREE.Mesh(glowGeometry, glowMaterial);
  cube.add(glow);

  // Particle ring
  const ringGeometry = new THREE.TorusGeometry(2.5, 0.1, 16, 100);
  const ringMaterial = new THREE.MeshBasicMaterial({ color: tech.color });
  const ring = new THREE.Mesh(ringGeometry, ringMaterial);
  ring.rotation.x = Math.PI / 2;
  ring.position.y = -1;
  cube.add(ring);

  // Label
  createLabel(tech.name.toUpperCase(), x, y + 4, z);
}

function animate() {
  requestAnimationFrame(animate);

  const delta = clock.getDelta();

  // Movement
  velocity.x -= velocity.x * 10.0 * delta;
  velocity.z -= velocity.z * 10.0 * delta;

  direction.z = Number(moveForward) - Number(moveBackward);
  direction.x = Number(moveRight) - Number(moveLeft);
  direction.normalize();

  if (moveForward || moveBackward) velocity.z -= direction.z * 50.0 * delta;
  if (moveLeft || moveRight) velocity.x -= direction.x * 50.0 * delta;

  camera.position.x += velocity.x * delta;
  camera.position.z += velocity.z * delta;

  // Animate tech objects
  techObjects.forEach(obj => {
    obj.rotation.y += delta * 0.5;
    obj.rotation.x += delta * 0.2;
    obj.position.y = obj.userData.originalY + Math.sin(Date.now() * 0.001 * obj.userData.floatSpeed) * 0.5;
    
    // Pulse glow
    if (obj.children[0]) {
      obj.children[0].material.opacity = 0.2 + Math.sin(Date.now() * 0.002) * 0.1;
    }
    
    // Rotate ring
    if (obj.children[1]) {
      obj.children[1].rotation.z += delta;
    }
  });

  // Check for nearby tech
  checkInteractables();

  renderer.render(scene, camera);
}

function checkInteractables() {
  raycaster.setFromCamera(new THREE.Vector2(0, 0), camera);
  const intersects = raycaster.intersectObjects(techObjects);

  if (intersects.length > 0 && intersects[0].distance < 8) {
    const object = intersects[0].object;
    if (currentInteractable !== object) {
      currentInteractable = object;
      showInteractionPanel(object);
    }
  } else {
    if (currentInteractable) {
      currentInteractable = null;
      hideInteractionPanel();
    }
  }
}

function showInteractionPanel(object) {
  const techId = object.userData.techId;
  const tech = technologies[techId];
  
  document.getElementById('interact-title').textContent = tech.name;
  document.getElementById('interact-desc').textContent = `${tech.desc}\n\nCategory: ${tech.category} | Cost: $${tech.cost.toLocaleString()}`;
  
  const buttonsDiv = document.getElementById('interact-buttons');
  buttonsDiv.innerHTML = '';
  
  if (tech.unlocked) {
    const useBtn = document.createElement('button');
    useBtn.className = 'action-btn';
    useBtn.textContent = 'USE TECHNOLOGY';
    useBtn.onclick = () => useTechnology(techId);
    buttonsDiv.appendChild(useBtn);
  } else {
    const unlockBtn = document.createElement('button');
    unlockBtn.className = 'action-btn';
    unlockBtn.textContent = `UNLOCK - $${tech.cost.toLocaleString()}`;
    unlockBtn.onclick = () => unlockTechnology(techId);
    buttonsDiv.appendChild(unlockBtn);
  }
  
  document.getElementById('interact-panel').classList.remove('hidden');
}

function hideInteractionPanel() {
  document.getElementById('interact-panel').classList.add('hidden');
}

function unlockTechnology(techId) {
  const tech = technologies[techId];
  
  if (gameState.funding >= tech.cost) {
    gameState.funding -= tech.cost;
    tech.unlocked = true;
    gameState.techUnlocked.push(techId);
    addXP(50);
    updateHUD();
    updateTechPanel();
    showNotification(`‚úÖ UNLOCKED: ${tech.name}! +50 XP`);
    hideInteractionPanel();
  } else {
    showNotification(`‚ùå Insufficient funding! Need $${(tech.cost - gameState.funding).toLocaleString()} more`);
  }
}

function useTechnology(techId) {
  const tech = technologies[techId];
  gameState.reputation += 20;
  addXP(30);
  updateHUD();
  showNotification(`‚ö° Using ${tech.name}... +20 Reputation, +30 XP`);
}

function addXP(amount) {
  gameState.xp += amount;
  while (gameState.xp >= gameState.xpMax) {
    gameState.xp -= gameState.xpMax;
    gameState.level++;
    gameState.xpMax = Math.floor(gameState.xpMax * 1.5);
    gameState.funding += 50000;
    showNotification(`üéâ LEVEL UP! Now Level ${gameState.level}! +$50,000 bonus`);
  }
}

function updateHUD() {
  document.getElementById('char-name').textContent = gameState.character;
  document.getElementById('level').textContent = gameState.level;
  document.getElementById('xp').textContent = `${gameState.xp}/${gameState.xpMax}`;
  document.getElementById('rep').textContent = gameState.reputation;
  document.getElementById('funding').textContent = `$${gameState.funding.toLocaleString()}`;
  document.getElementById('tech-count').textContent = gameState.techUnlocked.length;
}

function updateTechPanel() {
  const techList = document.getElementById('tech-list');
  techList.innerHTML = '';
  
  Object.entries(technologies).forEach(([id, tech]) => {
    const techDiv = document.createElement('div');
    techDiv.className = 'tech-item' + (tech.unlocked ? ' unlocked' : '');
    techDiv.innerHTML = `
      <div class="tech-name">${tech.unlocked ? '‚úÖ ' : 'üîí '}${tech.name}</div>
      <div class="tech-desc">${tech.desc}</div>
      <div class="tech-cost">${tech.unlocked ? 'UNLOCKED' : '$' + tech.cost.toLocaleString()}</div>
    `;
    techList.appendChild(techDiv);
  });
}

function showNotification(message) {
  const notif = document.getElementById('notification');
  notif.textContent = message;
  notif.classList.add('show');
  setTimeout(() => {
    notif.classList.remove('show');
  }, 3500);
}

function onWindowResize() {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
}

function onKeyDown(event) {
  switch (event.code) {
    case 'KeyW': moveForward = true; break;
    case 'KeyS': moveBackward = true; break;
    case 'KeyA': moveLeft = true; break;
    case 'KeyD': moveRight = true; break;
    case 'KeyE':
      if (currentInteractable) {
        const techId = currentInteractable.userData.techId;
        const tech = technologies[techId];
        if (tech.unlocked) {
          useTechnology(techId);
        } else {
          unlockTechnology(techId);
        }
      }
      break;
  }
}

function onKeyUp(event) {
  switch (event.code) {
    case 'KeyW': moveForward = false; break;
    case 'KeyS': moveBackward = false; break;
    case 'KeyA': moveLeft = false; break;
    case 'KeyD': moveRight = false; break;
  }
}

function onMouseMove(event) {
  if (document.pointerLockElement === document.body) {
    const movementX = event.movementX || 0;
    const movementY = event.movementY || 0;

    camera.rotation.y -= movementX * 0.002;
    camera.rotation.x -= movementY * 0.002;
    camera.rotation.x = Math.max(-Math.PI / 2, Math.min(Math.PI / 2, camera.rotation.x));
  }
}

// Character selection
let selectedCharacter = null;

document.querySelectorAll('.char-card').forEach(card => {
  card.addEventListener('click', () => {
    document.querySelectorAll('.char-card').forEach(c => c.classList.remove('selected'));
    card.classList.add('selected');
    selectedCharacter = card.dataset.char;
    document.getElementById('start-btn').disabled = false;
    document.getElementById('start-btn').textContent = 'START YOUR JOURNEY';
  });
});

document.getElementById('start-btn').addEventListener('click', () => {
  if (selectedCharacter) {
    gameState.character = selectedCharacter;
    document.getElementById('char-select').classList.add('hidden');
    document.getElementById('hud').classList.remove('hidden');
    document.getElementById('tech-panel').classList.remove('hidden');
    document.getElementById('controls').classList.remove('hidden');
    updateHUD();
    updateTechPanel();
    setTimeout(() => {
      showNotification(`Welcome, ${selectedCharacter}! Explore the tech city and unlock cutting-edge technologies!`);
    }, 1000);
    setTimeout(() => {
      showNotification('üí° Walk up to glowing tech cubes and press E to interact!');
    }, 5000);
  }
});

// Initialize when page loads
window.addEventListener('load', () => {
  setTimeout(initScene, 500);
});
</script>
</body>
</html>