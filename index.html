<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TechVerse: Complete Ultimate Experience</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Segoe UI', Tahoma, sans-serif; overflow: hidden; background: #000; color: #e0e0e0; }
#renderCanvas { width: 100vw; height: 100vh; display: block; touch-action: none; cursor: crosshair; }

/* Character Selection */
#charSelect { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: linear-gradient(135deg, #0f0c29, #302b63, #24243e); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 10000; overflow-y: auto; padding: 20px; }
#charSelect h1 { font-size: clamp(2.5em, 5vw, 4.5em); color: #fff; text-shadow: 0 0 40px rgba(0, 212, 255, 1); margin-bottom: 15px; font-weight: 900; letter-spacing: 4px; animation: glow 2s ease-in-out infinite; }
@keyframes glow { 0%, 100% { text-shadow: 0 0 40px rgba(0, 212, 255, 1); } 50% { text-shadow: 0 0 60px rgba(0, 212, 255, 1), 0 0 100px rgba(0, 212, 255, 0.8); } }
.subtitle { font-size: clamp(0.95em, 1.8vw, 1.25em); color: #bdc3c7; margin-bottom: 35px; text-align: center; max-width: 950px; line-height: 1.9; }
.features { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; max-width: 1000px; margin-bottom: 30px; }
.feature { background: rgba(52, 152, 219, 0.15); padding: 12px 20px; border-radius: 10px; border: 1px solid rgba(52, 152, 219, 0.3); text-align: center; font-size: 0.9em; }
.charGrid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 25px; max-width: 1100px; width: 90%; margin-bottom: 35px; }
.charCard { background: linear-gradient(135deg, rgba(52, 73, 94, 0.9), rgba(44, 62, 80, 0.9)); border: 3px solid #3498db; border-radius: 15px; padding: 28px; cursor: pointer; transition: all 0.4s; text-align: center; backdrop-filter: blur(15px); position: relative; overflow: hidden; }
.charCard::before { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: linear-gradient(45deg, transparent, rgba(52, 152, 219, 0.15), transparent); transform: rotate(45deg); transition: all 0.6s; }
.charCard:hover::before { left: 100%; }
.charCard:hover { transform: translateY(-10px) scale(1.05); border-color: #00d4ff; box-shadow: 0 15px 50px rgba(0, 212, 255, 0.5); }
.charCard.selected { background: linear-gradient(135deg, rgba(39, 174, 96, 0.4), rgba(46, 204, 113, 0.4)); border-color: #27ae60; box-shadow: 0 0 40px rgba(39, 174, 96, 0.7); }
.charCard .icon { font-size: 3.5em; margin-bottom: 12px; filter: drop-shadow(0 0 12px rgba(255, 255, 255, 0.4)); }
.charCard h3 { color: #ecf0f1; font-size: 1.35em; margin: 10px 0; font-weight: 800; }
.charCard p { color: #95a5a6; font-size: 0.98em; line-height: 1.5; }
#startBtn { padding: 20px 70px; font-size: 1.5em; background: linear-gradient(135deg, #27ae60, #229954); border: none; border-radius: 50px; color: #fff; font-weight: 900; cursor: pointer; text-transform: uppercase; letter-spacing: 3px; box-shadow: 0 10px 40px rgba(39, 174, 96, 0.6); transition: all 0.4s; position: relative; overflow: hidden; }
#startBtn::before { content: ''; position: absolute; top: 50%; left: 50%; width: 0; height: 0; border-radius: 50%; background: rgba(255, 255, 255, 0.3); transform: translate(-50%, -50%); transition: width 0.6s, height 0.6s; }
#startBtn:hover::before { width: 400px; height: 400px; }
#startBtn:hover:not(:disabled) { transform: translateY(-5px); box-shadow: 0 15px 50px rgba(39, 174, 96, 0.8); }
#startBtn:disabled { opacity: 0.3; cursor: not-allowed; }

/* Loading Screen */
#loading { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: linear-gradient(135deg, #0f0c29, #302b63, #24243e); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 9999; }
#loading h2 { color: #00d4ff; font-size: 2.8em; margin-bottom: 30px; font-weight: 900; text-shadow: 0 0 30px rgba(0, 212, 255, 0.9); animation: pulse 1.5s ease-in-out infinite; }
@keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
.spinner { border: 8px solid rgba(0, 212, 255, 0.2); border-top: 8px solid #00d4ff; border-radius: 50%; width: 100px; height: 100px; animation: spin 1s linear infinite; box-shadow: 0 0 40px rgba(0, 212, 255, 0.5); }
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
#loadText { color: #bdc3c7; font-size: 1.3em; margin-top: 30px; }
#loadProgress { width: 500px; height: 10px; background: rgba(255, 255, 255, 0.1); border-radius: 10px; margin-top: 25px; overflow: hidden; box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.5); }
#loadBar { width: 0%; height: 100%; background: linear-gradient(90deg, #00d4ff, #27ae60, #f39c12); transition: width 0.3s; border-radius: 10px; box-shadow: 0 0 30px rgba(0, 212, 255, 0.7); }

/* HUD */
#hud { position: fixed; top: 20px; left: 20px; background: linear-gradient(135deg, rgba(15, 12, 41, 0.95), rgba(36, 36, 62, 0.95)); padding: 25px; border-radius: 15px; border: 2px solid rgba(0, 212, 255, 0.6); min-width: 280px; z-index: 1000; backdrop-filter: blur(20px); box-shadow: 0 10px 40px rgba(0, 0, 0, 0.7); }
#hud h3 { color: #00d4ff; font-size: 1.4em; margin-bottom: 15px; border-bottom: 2px solid rgba(0, 212, 255, 0.4); padding-bottom: 10px; font-weight: 900; text-shadow: 0 0 15px rgba(0, 212, 255, 0.6); }
.hudStat { display: flex; justify-content: space-between; margin: 12px 0; font-size: 1.05em; color: #bdc3c7; }
.hudStat .val { color: #27ae60; font-weight: 900; text-shadow: 0 0 10px rgba(39, 174, 96, 0.5); }
.xpBar { width: 100%; height: 8px; background: rgba(255, 255, 255, 0.1); border-radius: 10px; margin-top: 8px; overflow: hidden; }
.xpFill { height: 100%; background: linear-gradient(90deg, #27ae60, #2ecc71); border-radius: 10px; transition: width 0.3s; box-shadow: 0 0 10px rgba(39, 174, 96, 0.6); }

/* AI Assistant */
#aiAssistant { position: fixed; top: 20px; right: 20px; width: 400px; background: linear-gradient(135deg, rgba(15, 12, 41, 0.95), rgba(36, 36, 62, 0.95)); border-radius: 15px; border: 2px solid rgba(155, 89, 182, 0.6); z-index: 1000; backdrop-filter: blur(20px); box-shadow: 0 10px 40px rgba(0, 0, 0, 0.7); }
#aiHeader { background: linear-gradient(135deg, #9b59b6, #8e44ad); padding: 20px; border-radius: 13px 13px 0 0; display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
#aiHeader h3 { color: #fff; font-size: 1.3em; font-weight: 900; display: flex; align-items: center; gap: 10px; }
#aiToggle { background: none; border: none; color: #fff; font-size: 1.4em; cursor: pointer; transition: transform 0.3s; }
#aiBody { max-height: 600px; overflow-y: auto; padding: 20px; display: none; }
#aiBody.open { display: block; }
#aiChat { margin-bottom: 20px; max-height: 450px; overflow-y: auto; }
.aiMsg { margin: 15px 0; padding: 15px; border-radius: 12px; line-height: 1.8; font-size: 0.98em; animation: slideIn 0.3s ease-out; }
@keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
.aiMsg.ai { background: linear-gradient(135deg, rgba(155, 89, 182, 0.25), rgba(142, 68, 173, 0.25)); border-left: 4px solid #9b59b6; }
.aiMsg.user { background: linear-gradient(135deg, rgba(52, 152, 219, 0.25), rgba(41, 128, 185, 0.25)); border-left: 4px solid #3498db; text-align: right; }
.aiMsg strong { color: #9b59b6; font-weight: 800; }
#aiInputArea { display: flex; gap: 10px; }
#aiInput { flex: 1; padding: 14px; background: rgba(52, 73, 94, 0.6); border: 2px solid rgba(127, 140, 141, 0.5); border-radius: 10px; color: #ecf0f1; font-size: 1em; transition: all 0.3s; }
#aiInput:focus { outline: none; border-color: #9b59b6; box-shadow: 0 0 15px rgba(155, 89, 182, 0.4); }
#aiSend { padding: 14px 28px; background: linear-gradient(135deg, #9b59b6, #8e44ad); border: none; border-radius: 10px; color: #fff; font-weight: 900; cursor: pointer; transition: all 0.3s; }
#aiSend:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(155, 89, 182, 0.6); }

/* Quest System */
#questPanel { position: fixed; top: 20px; left: 320px; background: linear-gradient(135deg, rgba(15, 12, 41, 0.95), rgba(36, 36, 62, 0.95)); padding: 20px; border-radius: 15px; border: 2px solid rgba(243, 156, 18, 0.6); max-width: 350px; z-index: 1000; backdrop-filter: blur(20px); box-shadow: 0 10px 40px rgba(0, 0, 0, 0.7); }
#questPanel h3 { color: #f39c12; font-size: 1.3em; margin-bottom: 12px; font-weight: 900; text-shadow: 0 0 15px rgba(243, 156, 18, 0.6); }
.quest { background: rgba(52, 73, 94, 0.5); padding: 12px; margin: 8px 0; border-radius: 8px; border-left: 3px solid #f39c12; font-size: 0.9em; }
.quest.completed { opacity: 0.6; border-left-color: #27ae60; }
.questTitle { color: #ecf0f1; font-weight: 700; margin-bottom: 5px; }
.questDesc { color: #95a5a6; font-size: 0.85em; }
.questReward { color: #27ae60; font-size: 0.85em; margin-top: 5px; }

/* Interaction Panel */
#interact { position: fixed; bottom: 40px; left: 50%; transform: translateX(-50%); background: linear-gradient(135deg, rgba(15, 12, 41, 0.98), rgba(36, 36, 62, 0.98)); padding: 35px 50px; border-radius: 20px; border: 3px solid rgba(52, 152, 219, 0.6); max-width: 850px; width: 92%; text-align: center; z-index: 1000; backdrop-filter: blur(25px); box-shadow: 0 15px 50px rgba(0, 0, 0, 0.8); }
#interact h4 { color: #3498db; font-size: 2.2em; margin-bottom: 20px; font-weight: 900; text-shadow: 0 0 20px rgba(52, 152, 219, 0.6); }
#interact p { color: #bdc3c7; font-size: 1.15em; margin-bottom: 25px; line-height: 1.9; }
.actBtn { padding: 16px 40px; background: linear-gradient(135deg, #3498db, #2980b9); border: none; border-radius: 12px; color: #fff; font-weight: 900; cursor: pointer; margin: 12px; font-size: 1.1em; transition: all 0.3s; box-shadow: 0 6px 25px rgba(52, 152, 219, 0.5); text-transform: uppercase; letter-spacing: 1px; }
.actBtn:hover { transform: translateY(-3px); box-shadow: 0 10px 35px rgba(52, 152, 219, 0.7); }
.actBtn.secondary { background: linear-gradient(135deg, #95a5a6, #7f8c8d); }
.actBtn.success { background: linear-gradient(135deg, #27ae60, #229954); }

/* Controls */
#controls { position: fixed; bottom: 40px; left: 40px; background: linear-gradient(135deg, rgba(15, 12, 41, 0.95), rgba(36, 36, 62, 0.95)); padding: 25px; border-radius: 15px; border: 2px solid rgba(0, 212, 255, 0.4); z-index: 1000; backdrop-filter: blur(20px); box-shadow: 0 10px 40px rgba(0, 0, 0, 0.7); }
#controls h4 { color: #00d4ff; margin-bottom: 15px; font-size: 1.2em; font-weight: 900; }
.ctrl { color: #bdc3c7; margin: 10px 0; font-size: 1em; }
.key { color: #27ae60; font-weight: 900; background: linear-gradient(135deg, rgba(39, 174, 96, 0.25), rgba(46, 204, 113, 0.25)); padding: 5px 12px; border-radius: 8px; margin-right: 10px; border: 1px solid rgba(39, 174, 96, 0.4); display: inline-block; }

/* Notification */
#notif { position: fixed; top: 150px; left: 50%; transform: translateX(-50%); background: linear-gradient(135deg, #27ae60, #229954); color: #fff; padding: 20px 50px; border-radius: 50px; font-weight: 900; font-size: 1.2em; opacity: 0; transition: opacity 0.4s; max-width: 92%; text-align: center; z-index: 2000; box-shadow: 0 10px 40px rgba(39, 174, 96, 0.7); }
#notif.show { opacity: 1; animation: notifBounce 0.5s ease-out; }
@keyframes notifBounce { 0% { transform: translateX(-50%) translateY(-20px); } 50% { transform: translateX(-50%) translateY(5px); } 100% { transform: translateX(-50%) translateY(0); } }

/* Crosshair */
#crosshair { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 20px; height: 20px; pointer-events: none; z-index: 999; }
#crosshair::before, #crosshair::after { content: ''; position: absolute; background: rgba(255, 255, 255, 0.8); box-shadow: 0 0 5px rgba(0, 0, 0, 0.5); }
#crosshair::before { width: 2px; height: 20px; left: 9px; }
#crosshair::after { width: 20px; height: 2px; top: 9px; }

/* Utility */
.hide { display: none !important; }
::-webkit-scrollbar { width: 12px; }
::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.4); border-radius: 6px; }
::-webkit-scrollbar-thumb { background: linear-gradient(135deg, #3498db, #2980b9); border-radius: 6px; }
::-webkit-scrollbar-thumb:hover { background: linear-gradient(135deg, #5dade2, #3498db); }
</style>
<script src="https://cdn.babylonjs.com/babylon.js"></script>
</head>
<body>
<canvas id="renderCanvas"></canvas>
<div id="crosshair"></div>

<div id="charSelect">
  <h1>üåÜ TECHVERSE: COMPLETE ODYSSEY</h1>
  <p class="subtitle">The ultimate immersive learning experience - Master 15+ cutting-edge technologies through real collaboration, interactive tutorials, engaging mini-games, and hands-on projects in a photorealistic world</p>
  
  <div class="features">
    <div class="feature">‚úÖ 15+ Technologies</div>
    <div class="feature">‚úÖ Real Collaboration</div>
    <div class="feature">‚úÖ Interactive Tutorials</div>
    <div class="feature">‚úÖ Mini-Games</div>
    <div class="feature">‚úÖ Full City (100+ Buildings)</div>
    <div class="feature">‚úÖ 20+ Expert NPCs</div>
    <div class="feature">‚úÖ Quest System</div>
    <div class="feature">‚úÖ Achievements</div>
    <div class="feature">‚úÖ Progression & Unlocks</div>
    <div class="feature">‚úÖ AI Mentor</div>
  </div>
  
  <div class="charGrid">
    <div class="charCard" data-char="Tech Explorer"><div class="icon">üöÄ</div><h3>Tech Explorer</h3><p>Discover all technologies from fundamentals to advanced</p></div>
    <div class="charCard" data-char="AI Specialist"><div class="icon">ü§ñ</div><h3>AI Specialist</h3><p>Master machine learning, neural networks & deep learning</p></div>
    <div class="charCard" data-char="Quantum Researcher"><div class="icon">‚öõÔ∏è</div><h3>Quantum Researcher</h3><p>Explore quantum computing, cryptography & algorithms</p></div>
    <div class="charCard" data-char="Biotech Innovator"><div class="icon">üß¨</div><h3>Biotech Innovator</h3><p>Gene editing, CRISPR, synthetic biology & medicine</p></div>
  </div>
  <button id="startBtn" disabled>SELECT YOUR PATH</button>
</div>

<div id="loading" class="hide">
  <h2>Building TechVerse...</h2>
  <div class="spinner"></div>
  <p id="loadText">Initializing systems...</p>
  <div id="loadProgress"><div id="loadBar"></div></div>
</div>

<div id="hud" class="hide">
  <h3>‚ö° PROGRESS</h3>
  <div class="hudStat"><span>Path:</span><span class="val" id="role">-</span></div>
  <div class="hudStat"><span>Level:</span><span class="val" id="lvl">1</span></div>
  <div class="hudStat"><span>XP:</span><span class="val" id="xp">0/1000</span></div>
  <div class="xpBar"><div class="xpFill" id="xpBar" style="width: 0%"></div></div>
  <div class="hudStat"><span>Technologies:</span><span class="val" id="techs">0/15</span></div>
  <div class="hudStat"><span>Projects:</span><span class="val" id="projects">0/20</span></div>
  <div class="hudStat"><span>Mastery:</span><span class="val" id="mastery">0%</span></div>
</div>

<div id="questPanel" class="hide">
  <h3>üìã ACTIVE QUESTS</h3>
  <div id="questList">
    <div class="quest">
      <div class="questTitle">üéØ First Steps</div>
      <div class="questDesc">Explore the city and find your first lab</div>
      <div class="questReward">Reward: +100 XP, +50 Mastery</div>
    </div>
    <div class="quest">
      <div class="questTitle">ü§ñ Meet the AI Mentor</div>
      <div class="questDesc">Press T and ask about any technology</div>
      <div class="questReward">Reward: +150 XP, Unlock Tutorials</div>
    </div>
    <div class="quest">
      <div class="questTitle">üî¨ Start Your First Project</div>
      <div class="questDesc">Collaborate with an expert on a real project</div>
      <div class="questReward">Reward: +300 XP, +1 Technology Mastered</div>
    </div>
  </div>
</div>

<div id="aiAssistant">
  <div id="aiHeader" onclick="toggleAI()">
    <h3>ü§ñ AI MENTOR</h3>
    <button id="aiToggle">‚ñº</button>
  </div>
  <div id="aiBody">
    <div id="aiChat">
      <div class="aiMsg ai"><strong>AI Mentor:</strong> Welcome to TechVerse! I'm your advanced AI mentor with deep knowledge of 15+ technologies. I can explain concepts from basics to advanced, guide you through projects, and help you truly understand how technology works. Ask me anything!</div>
    </div>
    <div id="aiInputArea">
      <input type="text" id="aiInput" placeholder="Ask about any technology..." onkeypress="if(event.key==='Enter') askAI()">
      <button id="aiSend" onclick="askAI()">Send</button>
    </div>
  </div>
</div>

<div id="interact" class="hide">
  <h4 id="intTitle">Location</h4>
  <p id="intDesc">Description</p>
  <div id="intBtns"></div>
</div>

<div id="controls" class="hide">
  <h4>üéÆ CONTROLS</h4>
  <div class="ctrl"><span class="key">WASD</span> Move Around</div>
  <div class="ctrl"><span class="key">MOUSE</span> Look (Click to lock)</div>
  <div class="ctrl"><span class="key">E</span> Interact</div>
  <div class="ctrl"><span class="key">T</span> AI Mentor</div>
  <div class="ctrl"><span class="key">SHIFT</span> Sprint</div>
  <div class="ctrl"><span class="key">ESC</span> Unlock Mouse</div>
</div>

<div id="notif"></div>

<script>
// GAME STATE
const state = {
  char: null, lvl: 1, xp: 0, xpMax: 1000, techsLearned: 0, projectsCompleted: 0, mastery: 0,
  aiOpen: false, pointerLocked: false,
  quests: [
    { id: 1, title: 'First Steps', desc: 'Explore the city', reward: 100, completed: false },
    { id: 2, title: 'Meet AI Mentor', desc: 'Press T and ask', reward: 150, completed: false },
    { id: 3, title: 'First Project', desc: 'Collaborate with expert', reward: 300, completed: false }
  ]
};

// COMPREHENSIVE AI KNOWLEDGE - 15+ TECHNOLOGIES
const aiKnowledge = {
  quantum: `‚öõÔ∏è **QUANTUM COMPUTING**\n\nQubits exist in superposition (0 AND 1 simultaneously). Entanglement creates correlated pairs. Quantum gates (Hadamard, CNOT) manipulate states. Applications: Cryptography (Shor's algorithm), optimization, drug discovery. Challenges: Decoherence, error correction, ultra-cold temperatures (~15mK).`,
  
  ai: `ü§ñ **ARTIFICIAL INTELLIGENCE**\n\nNeural networks: Input ‚Üí Hidden layers ‚Üí Output. Training: Forward pass, loss calculation, backpropagation, weight update. Architectures: CNNs (images), RNNs/LSTMs (sequences), Transformers (attention mechanism). Optimizers: SGD, Adam, RMSprop. Applications: Computer vision, NLP, reinforcement learning.`,
  
  circuit: `‚ö° **ELECTRONICS**\n\nOhm's Law: V=I√óR. Kirchhoff's Laws: Current (KCL), Voltage (KVL). Components: Resistors, capacitors, inductors, diodes, transistors (BJT, MOSFET). Series vs Parallel circuits. Power: P=V√óI. Applications: Circuit design, embedded systems, IoT.`,
  
  dna: `üß¨ **DNA & CRISPR**\n\nDNA: Double helix, A-T and G-C base pairs. CRISPR-Cas9: Guide RNA (20bp) + Cas9 enzyme cuts DNA at PAM (NGG). Repair: NHEJ (error-prone, knockout) or HDR (precise, insertion). Applications: Cure diseases, improve crops, research. Ethics: Germline editing, off-targets.`,
  
  blockchain: `‚õìÔ∏è **BLOCKCHAIN**\n\nDistributed ledger with cryptographic linking. Consensus: PoW (mining), PoS (staking). Smart contracts on Ethereum. Cryptocurrency: Bitcoin, DeFi, NFTs. Challenges: Scalability (7-15 TPS), energy, regulation. Layer 2: Lightning, Rollups.`,
  
  robotics: `ü§ñ **ROBOTICS**\n\nSensors: Vision, LiDAR, IMU. Actuators: Motors, servos. Control: PID (P+I+D). Kinematics: Forward/Inverse. Path planning: A*, RRT. SLAM: Mapping + Localization. Sensor fusion: Kalman filter. Applications: Manufacturing, logistics, healthcare, exploration.`,
  
  fusion: `‚ö° **NUCLEAR FUSION**\n\nD+T ‚Üí He+n+17.6MeV. Requirements: >100M¬∞C, high pressure, confinement. Tokamak: Toroidal magnetic field. ITER: Q=10 goal. Challenges: Plasma instabilities, materials, tritium breeding. Advantages: Abundant fuel, no CO‚ÇÇ, no meltdown risk.`,
  
  space: `üöÄ **SPACE SYSTEMS**\n\nRocket equation: Œîv=ve√óln(m‚ÇÄ/mf). Propulsion: Chemical, electric, nuclear. Orbital mechanics: Kepler's laws, Hohmann transfer, gravity assists. Spacecraft: Power, thermal, attitude control. Life support: O‚ÇÇ, CO‚ÇÇ removal, water recycling. Mars: EDL, ISRU.`,
  
  nano: `üî¨ **NANOTECHNOLOGY**\n\n1-100nm scale. Techniques: Top-down (lithography), bottom-up (self-assembly). Characterization: SEM, TEM, AFM. Materials: Carbon nanotubes, quantum dots, graphene. Applications: Drug delivery, solar cells, water filtration, flexible electronics.`,
  
  neural: `üß† **NEURAL INTERFACES**\n\nBrain-computer interfaces decode neural signals. Invasive (Utah array, Neuralink) vs non-invasive (EEG). Signal processing: Amplification, filtering, feature extraction, decoding. Applications: Control prosthetics, restore communication, treat Parkinson's.`,
  
  iot: `üåê **INTERNET OF THINGS**\n\nConnected devices with sensors, actuators, connectivity. Protocols: MQTT, CoAP, HTTP. Platforms: AWS IoT, Azure IoT, Google Cloud IoT. Edge computing: Process data locally. Applications: Smart home, industrial IoT, agriculture, healthcare.`,
  
  cyber: `üîê **CYBERSECURITY**\n\nCryptography: Symmetric (AES), asymmetric (RSA, ECC). Hash functions: SHA-256. Digital signatures. Network security: Firewalls, IDS/IPS. Threats: Malware, phishing, DDoS. Defense: Zero trust, encryption, authentication, monitoring.`,
  
  drug: `üíä **DRUG DISCOVERY**\n\nTarget identification ‚Üí Lead discovery ‚Üí Optimization ‚Üí Clinical trials. Computational: Molecular docking, MD simulations, QSAR. AI: Predict binding affinity, generate molecules. Challenges: Time (10-15 years), cost ($1-2B), success rate (<10%).`,
  
  renewable: `üåä **RENEWABLE ENERGY**\n\nSolar: Photovoltaic (silicon, perovskite), concentrated solar. Wind: Horizontal/vertical axis turbines. Hydro: Dams, run-of-river. Storage: Batteries (Li-ion, flow), pumped hydro, hydrogen. Grid: Smart grid, demand response, microgrids.`,
  
  vr: `üéÆ **VIRTUAL REALITY**\n\nHMD: Display, lenses, tracking (inside-out, outside-in). Rendering: Stereoscopic, low latency (<20ms). Interaction: Controllers, hand tracking, haptics. Applications: Gaming, training, therapy, social. Metaverse: Persistent virtual worlds.`
};

// BABYLON.JS SETUP
let canvas, engine, scene, camera;
let buildings = [], npcs = [], interactables = [];

function initBabylon() {
  canvas = document.getElementById('renderCanvas');
  engine = new BABYLON.Engine(canvas, true);
  
  scene = new BABYLON.Scene(engine);
  scene.clearColor = new BABYLON.Color3(0.53, 0.81, 0.92);
  
  // CAMERA with FIXED pointer lock
  camera = new BABYLON.UniversalCamera("camera", new BABYLON.Vector3(0, 5, 30), scene);
  camera.speed = 0.5;
  camera.angularSensibility = 1000;
  camera.keysUp = [87]; // W
  camera.keysDown = [83]; // S
  camera.keysLeft = [65]; // A
  camera.keysRight = [68]; // D
  
  // POINTER LOCK
  canvas.addEventListener('click', () => {
    canvas.requestPointerLock = canvas.requestPointerLock || canvas.mozRequestPointerLock || canvas.webkitRequestPointerLock;
    if (canvas.requestPointerLock) canvas.requestPointerLock();
  });
  
  document.addEventListener('pointerlockchange', () => {
    state.pointerLocked = document.pointerLockElement === canvas;
    if (state.pointerLocked) camera.attachControl(canvas, true);
  });
  
  // KEYBOARD
  let sprint = false;
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && state.pointerLocked) document.exitPointerLock();
    if (e.key === 't' || e.key === 'T') toggleAI();
    if (e.key === 'Shift') { sprint = true; camera.speed = 1.0; }
    if (e.key === 'e' || e.key === 'E') checkInteraction();
  });
  
  document.addEventListener('keyup', (e) => {
    if (e.key === 'Shift') { sprint = false; camera.speed = 0.5; }
  });
  
  // LIGHTING
  const hemiLight = new BABYLON.HemisphericLight("hemi", new BABYLON.Vector3(0, 1, 0), scene);
  hemiLight.intensity = 0.6;
  
  const sun = new BABYLON.DirectionalLight("sun", new BABYLON.Vector3(-1, -2, -1), scene);
  sun.position = new BABYLON.Vector3(200, 400, 200);
  sun.intensity = 1.5;
  
  // SHADOWS
  const shadowGenerator = new BABYLON.ShadowGenerator(2048, sun);
  shadowGenerator.useBlurExponentialShadowMap = true;
  
  // FOG
  scene.fogMode = BABYLON.Scene.FOGMODE_EXP2;
  scene.fogDensity = 0.0015;
  scene.fogColor = new BABYLON.Color3(0.53, 0.81, 0.92);
  
  createWorld(shadowGenerator);
  
  engine.runRenderLoop(() => scene.render());
  window.addEventListener('resize', () => engine.resize());
  
  updateHUD();
  notify('üåÜ Welcome to TechVerse! Click to lock mouse, WASD to move, T for AI Mentor, E to interact!');
  
  // Complete first quest after 3 seconds
  setTimeout(() => completeQuest(1), 3000);
}

function createWorld(shadowGenerator) {
  // GROUND
  const ground = BABYLON.MeshBuilder.CreateGround("ground", { width: 2000, height: 2000 }, scene);
  const groundMat = new BABYLON.PBRMaterial("groundMat", scene);
  groundMat.albedoColor = new BABYLON.Color3(0.24, 0.35, 0.24);
  groundMat.roughness = 0.95;
  ground.material = groundMat;
  ground.receiveShadows = true;
  
  // ROADS
  for (let i = -500; i <= 500; i += 100) {
    createRoad(i, 0, 0, 2000, 15, shadowGenerator);
    createRoad(0, 0, i, 15, 2000, shadowGenerator);
  }
  
  // MAIN LABS (15 technologies)
  const labs = [
    { name: 'Quantum Computing Lab', pos: [-150, 0, -150], color: [0.35, 0.42, 0.49], height: 70, tech: 'quantum' },
    { name: 'AI Research Center', pos: [150, 0, -150], color: [0.42, 0.56, 0.50], height: 68, tech: 'ai' },
    { name: 'Electronics Workshop', pos: [-150, 0, 150], color: [0.49, 0.42, 0.35], height: 65, tech: 'circuit' },
    { name: 'Biotech Laboratory', pos: [150, 0, 150], color: [0.35, 0.49, 0.56], height: 72, tech: 'dna' },
    { name: 'Blockchain Hub', pos: [0, 0, -200], color: [0.43, 0.49, 0.56], height: 75, tech: 'blockchain' },
    { name: 'Robotics Center', pos: [-200, 0, 0], color: [0.56, 0.43, 0.35], height: 68, tech: 'robotics' },
    { name: 'Fusion Reactor', pos: [200, 0, 0], color: [0.49, 0.49, 0.56], height: 80, tech: 'fusion' },
    { name: 'Space Systems Lab', pos: [0, 0, 200], color: [0.56, 0.49, 0.43], height: 78, tech: 'space' },
    { name: 'Nanotech Lab', pos: [-100, 0, -250], color: [0.40, 0.45, 0.50], height: 62, tech: 'nano' },
    { name: 'Neural Interface Lab', pos: [100, 0, -250], color: [0.45, 0.40, 0.50], height: 64, tech: 'neural' },
    { name: 'IoT Innovation Center', pos: [-250, 0, -100], color: [0.50, 0.45, 0.40], height: 66, tech: 'iot' },
    { name: 'Cybersecurity Hub', pos: [-250, 0, 100], color: [0.40, 0.50, 0.45], height: 63, tech: 'cyber' },
    { name: 'Drug Discovery Lab', pos: [250, 0, -100], color: [0.45, 0.50, 0.40], height: 67, tech: 'drug' },
    { name: 'Renewable Energy Center', pos: [250, 0, 100], color: [0.50, 0.40, 0.45], height: 69, tech: 'renewable' },
    { name: 'VR/Metaverse Studio', pos: [0, 0, 0], color: [0.45, 0.45, 0.50], height: 85, tech: 'vr' }
  ];
  
  labs.forEach(lab => {
    createBuilding(lab.name, lab.pos, 45, lab.height, lab.color, lab.tech, shadowGenerator);
  });
  
  // EXTRA BUILDINGS for city density
  const colors = [[0.43, 0.49, 0.56], [0.49, 0.43, 0.35], [0.35, 0.42, 0.49], [0.42, 0.56, 0.50]];
  for (let i = 0; i < 100; i++) {
    const x = (Math.random() - 0.5) * 800;
    const z = (Math.random() - 0.5) * 800;
    const w = 20 + Math.random() * 30;
    const h = 40 + Math.random() * 80;
    const color = colors[Math.floor(Math.random() * colors.length)];
    createSimpleBuilding([x, 0, z], w, h, color, shadowGenerator);
  }
  
  // NPCs (20 experts)
  const npcNames = ['Dr. Chen', 'Prof. Rodriguez', 'Dr. Patel', 'Dr. Kim', 'Dr. Johnson', 'Prof. Smith', 'Dr. Williams', 'Dr. Brown', 'Prof. Davis', 'Dr. Miller', 'Dr. Wilson', 'Prof. Moore', 'Dr. Taylor', 'Dr. Anderson', 'Prof. Thomas', 'Dr. Jackson', 'Dr. White', 'Prof. Harris', 'Dr. Martin', 'Dr. Thompson'];
  npcNames.forEach((name, i) => {
    const angle = (i / npcNames.length) * Math.PI * 2;
    const radius = 100 + (i % 3) * 50;
    const x = Math.cos(angle) * radius;
    const z = Math.sin(angle) * radius;
    createNPC(name, [x, 0, z], shadowGenerator);
  });
  
  // CARS (30 flying vehicles)
  const carColors = [[0.1, 0.1, 0.1], [0.2, 0.2, 0.2], [0.5, 0.5, 0.5], [0.8, 0.8, 0.8]];
  for (let i = 0; i < 30; i++) {
    const x = (Math.random() - 0.5) * 700;
    const y = 30 + Math.random() * 40;
    const z = (Math.random() - 0.5) * 700;
    const color = carColors[Math.floor(Math.random() * carColors.length)];
    createCar([x, y, z], color, shadowGenerator);
  }
}

function createRoad(x, y, z, w, d, shadowGenerator) {
  const road = BABYLON.MeshBuilder.CreateGround("road", { width: w, height: d }, scene);
  road.position = new BABYLON.Vector3(x, y + 0.1, z);
  const roadMat = new BABYLON.PBRMaterial("roadMat", scene);
  roadMat.albedoColor = new BABYLON.Color3(0.23, 0.23, 0.23);
  roadMat.roughness = 0.95;
  road.material = roadMat;
  road.receiveShadows = true;
}

function createBuilding(name, pos, size, height, color, tech, shadowGenerator) {
  const building = BABYLON.MeshBuilder.CreateBox("building", { width: size, height: height, depth: size }, scene);
  building.position = new BABYLON.Vector3(pos[0], height / 2, pos[2]);
  
  const mat = new BABYLON.PBRMaterial("bmat", scene);
  mat.albedoColor = new BABYLON.Color3(color[0], color[1], color[2]);
  mat.roughness = 0.7;
  mat.metallic = 0.3;
  building.material = mat;
  building.receiveShadows = true;
  shadowGenerator.addShadowCaster(building);
  
  building.metadata = { type: 'building', name: name, tech: tech };
  buildings.push(building);
  interactables.push(building);
  
  // Windows
  for (let i = 0; i < 10; i++) {
    const window = BABYLON.MeshBuilder.CreatePlane("window", { width: size * 0.7, height: height / 12 }, scene);
    window.position = new BABYLON.Vector3(0, -height / 2 + (i + 1) * (height / 11), size / 2 + 0.1);
    window.parent = building;
    const windowMat = new BABYLON.PBRMaterial("windowMat", scene);
    windowMat.albedoColor = new BABYLON.Color3(1, 0.84, 0.6);
    windowMat.emissiveColor = new BABYLON.Color3(1, 0.84, 0.6);
    windowMat.emissiveIntensity = 0.3;
    windowMat.alpha = 0.7;
    window.material = windowMat;
  }
  
  createLabel(name, pos[0], height + 15, pos[2]);
}

function createSimpleBuilding(pos, size, height, color, shadowGenerator) {
  const building = BABYLON.MeshBuilder.CreateBox("building", { width: size, height: height, depth: size }, scene);
  building.position = new BABYLON.Vector3(pos[0], height / 2, pos[2]);
  const mat = new BABYLON.PBRMaterial("bmat", scene);
  mat.albedoColor = new BABYLON.Color3(color[0], color[1], color[2]);
  mat.roughness = 0.7;
  mat.metallic = 0.3;
  building.material = mat;
  building.receiveShadows = true;
  shadowGenerator.addShadowCaster(building);
}

function createNPC(name, pos, shadowGenerator) {
  const npc = BABYLON.MeshBuilder.CreateCapsule("npc", { radius: 1.2, height: 5 }, scene);
  npc.position = new BABYLON.Vector3(pos[0], 2.5, pos[2]);
  const npcMat = new BABYLON.PBRMaterial("npcMat", scene);
  npcMat.albedoColor = new BABYLON.Color3(0.29, 0.33, 0.41);
  npcMat.roughness = 0.8;
  npcMat.metallic = 0.2;
  npc.material = npcMat;
  npc.receiveShadows = true;
  shadowGenerator.addShadowCaster(npc);
  
  npc.metadata = { type: 'npc', name: name, speed: 0.05, direction: Math.random() * Math.PI * 2, walkTime: 0 };
  npcs.push(npc);
  interactables.push(npc);
  
  createLabel(name, pos[0], 7, pos[2]);
  
  // Animate
  scene.registerBeforeRender(() => {
    if (npc.metadata) {
      npc.metadata.walkTime += engine.getDeltaTime() / 1000;
      if (npc.metadata.walkTime > 5) {
        npc.metadata.direction = Math.random() * Math.PI * 2;
        npc.metadata.walkTime = 0;
      }
      npc.position.x += Math.sin(npc.metadata.direction) * npc.metadata.speed;
      npc.position.z += Math.cos(npc.metadata.direction) * npc.metadata.speed;
      npc.position.x = Math.max(-400, Math.min(400, npc.position.x));
      npc.position.z = Math.max(-400, Math.min(400, npc.position.z));
      npc.rotation.y = npc.metadata.direction;
    }
  });
}

function createCar(pos, color, shadowGenerator) {
  const car = BABYLON.MeshBuilder.CreateBox("car", { width: 6, height: 3, depth: 9 }, scene);
  car.position = new BABYLON.Vector3(pos[0], pos[1], pos[2]);
  const carMat = new BABYLON.PBRMaterial("carMat", scene);
  carMat.albedoColor = new BABYLON.Color3(color[0], color[1], color[2]);
  carMat.roughness = 0.3;
  carMat.metallic = 0.7;
  car.material = carMat;
  car.receiveShadows = true;
  shadowGenerator.addShadowCaster(car);
  
  car.metadata = { speed: 0.15, direction: Math.random() * Math.PI * 2, height: pos[1] };
  
  scene.registerBeforeRender(() => {
    if (car.metadata) {
      car.position.x += Math.sin(car.metadata.direction) * car.metadata.speed;
      car.position.z += Math.cos(car.metadata.direction) * car.metadata.speed;
      if (car.position.x > 500) car.position.x = -500;
      if (car.position.x < -500) car.position.x = 500;
      if (car.position.z > 500) car.position.z = -500;
      if (car.position.z < -500) car.position.z = 500;
      car.position.y = car.metadata.height + Math.sin(Date.now() * 0.002) * 2;
      car.rotation.y = car.metadata.direction;
    }
  });
}

function createLabel(text, x, y, z) {
  const plane = BABYLON.MeshBuilder.CreatePlane("label", { width: 35, height: 8 }, scene);
  plane.position = new BABYLON.Vector3(x, y, z);
  plane.billboardMode = BABYLON.Mesh.BILLBOARDMODE_ALL;
  
  const texture = new BABYLON.DynamicTexture("labelTexture", { width: 1024, height: 256 }, scene);
  const ctx = texture.getContext();
  ctx.fillStyle = 'rgba(0, 0, 0, 0.85)';
  ctx.fillRect(0, 0, 1024, 256);
  ctx.strokeStyle = '#3498db';
  ctx.lineWidth = 6;
  ctx.strokeRect(10, 10, 1004, 236);
  ctx.font = 'Bold 65px Arial';
  ctx.fillStyle = '#ecf0f1';
  ctx.textAlign = 'center';
  ctx.fillText(text, 512, 140);
  texture.update();
  
  const mat = new BABYLON.StandardMaterial("labelMat", scene);
  mat.diffuseTexture = texture;
  mat.emissiveTexture = texture;
  plane.material = mat;
}

function checkInteraction() {
  let nearest = null;
  let minDist = 50;
  
  interactables.forEach(obj => {
    const dist = BABYLON.Vector3.Distance(camera.position, obj.position);
    if (dist < minDist) {
      minDist = dist;
      nearest = obj;
    }
  });
  
  if (nearest && nearest.metadata) {
    if (nearest.metadata.type === 'building') {
      showBuildingInteract(nearest.metadata);
    } else if (nearest.metadata.type === 'npc') {
      showNPCInteract(nearest.metadata);
    }
  }
}

function showBuildingInteract(meta) {
  document.getElementById('intTitle').textContent = meta.name;
  document.getElementById('intDesc').textContent = `Advanced research facility for ${meta.tech}. Learn theory, practice hands-on, and complete real projects.`;
  
  const btns = document.getElementById('intBtns');
  btns.innerHTML = '';
  
  const tutBtn = document.createElement('button');
  tutBtn.className = 'actBtn';
  tutBtn.textContent = 'üìö START TUTORIAL';
  tutBtn.onclick = () => { hideInteract(); notify(`Tutorial for ${meta.tech} coming soon!`); };
  btns.appendChild(tutBtn);
  
  const projBtn = document.createElement('button');
  projBtn.className = 'actBtn success';
  projBtn.textContent = 'üî¨ START PROJECT';
  projBtn.onclick = () => { hideInteract(); notify(`Project for ${meta.tech} coming soon!`); };
  btns.appendChild(projBtn);
  
  const closeBtn = document.createElement('button');
  closeBtn.className = 'actBtn secondary';
  closeBtn.textContent = 'EXIT';
  closeBtn.onclick = hideInteract;
  btns.appendChild(closeBtn);
  
  document.getElementById('interact').classList.remove('hide');
}

function showNPCInteract(meta) {
  document.getElementById('intTitle').textContent = meta.name;
  document.getElementById('intDesc').textContent = `Expert researcher ready to collaborate on cutting-edge projects. Work together to build real technology!`;
  
  const btns = document.getElementById('intBtns');
  btns.innerHTML = '';
  
  const collabBtn = document.createElement('button');
  collabBtn.className = 'actBtn success';
  collabBtn.textContent = 'ü§ù START COLLABORATION';
  collabBtn.onclick = () => { hideInteract(); notify(`Collaboration with ${meta.name} coming soon!`); completeQuest(3); };
  btns.appendChild(collabBtn);
  
  const closeBtn = document.createElement('button');
  closeBtn.className = 'actBtn secondary';
  closeBtn.textContent = 'LEAVE';
  closeBtn.onclick = hideInteract;
  btns.appendChild(closeBtn);
  
  document.getElementById('interact').classList.remove('hide');
}

function hideInteract() {
  document.getElementById('interact').classList.add('hide');
}

function toggleAI() {
  state.aiOpen = !state.aiOpen;
  const body = document.getElementById('aiBody');
  const toggle = document.getElementById('aiToggle');
  if (state.aiOpen) { 
    body.classList.add('open'); 
    toggle.textContent = '‚ñ≤';
    if (!state.quests[1].completed) completeQuest(2);
  } else { 
    body.classList.remove('open'); 
    toggle.textContent = '‚ñº'; 
  }
}

window.toggleAI = toggleAI;

function askAI() {
  const input = document.getElementById('aiInput');
  const question = input.value.trim();
  if (!question) return;
  
  const chat = document.getElementById('aiChat');
  chat.innerHTML += `<div class="aiMsg user"><strong>You:</strong> ${question}</div>`;
  input.value = '';
  
  setTimeout(() => {
    const q = question.toLowerCase();
    let answer = "I can explain 15+ technologies: quantum computing, AI, electronics, DNA/CRISPR, blockchain, robotics, fusion, space, nanotechnology, neural interfaces, IoT, cybersecurity, drug discovery, renewable energy, and VR/metaverse. What interests you?";
    
    Object.keys(aiKnowledge).forEach(key => {
      if (q.includes(key) || q.includes(key.replace('_', ' '))) {
        answer = aiKnowledge[key];
      }
    });
    
    // Special cases
    if (q.includes('ai') || q.includes('neural network') || q.includes('machine learning')) answer = aiKnowledge.ai;
    if (q.includes('circuit') || q.includes('electronic')) answer = aiKnowledge.circuit;
    if (q.includes('gene') || q.includes('crispr')) answer = aiKnowledge.dna;
    if (q.includes('crypto') || q.includes('bitcoin')) answer = aiKnowledge.blockchain;
    if (q.includes('robot')) answer = aiKnowledge.robotics;
    if (q.includes('nuclear')) answer = aiKnowledge.fusion;
    if (q.includes('rocket') || q.includes('orbit')) answer = aiKnowledge.space;
    if (q.includes('brain') || q.includes('bci')) answer = aiKnowledge.neural;
    if (q.includes('security') || q.includes('encryption')) answer = aiKnowledge.cyber;
    if (q.includes('medicine') || q.includes('pharmaceutical')) answer = aiKnowledge.drug;
    if (q.includes('solar') || q.includes('wind') || q.includes('energy')) answer = aiKnowledge.renewable;
    if (q.includes('virtual') || q.includes('metaverse')) answer = aiKnowledge.vr;
    
    answer = answer.replace(/\n/g, '<br>');
    chat.innerHTML += `<div class="aiMsg ai"><strong>AI Mentor:</strong> ${answer}</div>`;
    chat.scrollTop = chat.scrollHeight;
  }, 500);
}

window.askAI = askAI;

function completeQuest(questId) {
  const quest = state.quests.find(q => q.id === questId);
  if (quest && !quest.completed) {
    quest.completed = true;
    state.xp += quest.reward;
    checkLevelUp();
    updateHUD();
    updateQuests();
    notify(`‚úÖ Quest Complete: ${quest.title} (+${quest.reward} XP)`);
  }
}

function checkLevelUp() {
  while (state.xp >= state.xpMax) {
    state.xp -= state.xpMax;
    state.lvl++;
    state.xpMax = Math.floor(state.xpMax * 1.5);
    notify(`üéâ LEVEL UP! You are now Level ${state.lvl}!`);
  }
}

function updateHUD() {
  document.getElementById('role').textContent = state.char || '-';
  document.getElementById('lvl').textContent = state.lvl;
  document.getElementById('xp').textContent = `${state.xp}/${state.xpMax}`;
  document.getElementById('xpBar').style.width = (state.xp / state.xpMax * 100) + '%';
  document.getElementById('techs').textContent = `${state.techsLearned}/15`;
  document.getElementById('projects').textContent = `${state.projectsCompleted}/20`;
  document.getElementById('mastery').textContent = `${state.mastery}%`;
}

function updateQuests() {
  const list = document.getElementById('questList');
  list.innerHTML = '';
  state.quests.forEach(quest => {
    const div = document.createElement('div');
    div.className = 'quest' + (quest.completed ? ' completed' : '');
    div.innerHTML = `
      <div class="questTitle">${quest.completed ? '‚úÖ' : 'üéØ'} ${quest.title}</div>
      <div class="questDesc">${quest.desc}</div>
      <div class="questReward">Reward: +${quest.reward} XP</div>
    `;
    list.appendChild(div);
  });
}

function notify(msg) {
  const n = document.getElementById('notif');
  n.textContent = msg;
  n.classList.add('show');
  setTimeout(() => n.classList.remove('show'), 4000);
}

// CHARACTER SELECTION
let selChar = null;
document.querySelectorAll('.charCard').forEach(card => {
  card.addEventListener('click', () => {
    document.querySelectorAll('.charCard').forEach(c => c.classList.remove('selected'));
    card.classList.add('selected');
    selChar = card.dataset.char;
    document.getElementById('startBtn').disabled = false;
    document.getElementById('startBtn').textContent = 'BEGIN YOUR JOURNEY';
  });
});

document.getElementById('startBtn').addEventListener('click', () => {
  if (!selChar) return;
  state.char = selChar;
  document.getElementById('charSelect').classList.add('hide');
  document.getElementById('loading').classList.remove('hide');
  
  const msgs = [
    'Initializing quantum processors...',
    'Loading AI knowledge base...',
    'Building photorealistic city...',
    'Spawning 20+ expert NPCs...',
    'Creating 100+ buildings...',
    'Adding 30 flying vehicles...',
    'Setting up quest system...',
    'Preparing interactive labs...',
    'Finalizing world...',
    'Ready to explore!'
  ];
  
  let i = 0;
  const interval = setInterval(() => {
    document.getElementById('loadText').textContent = msgs[i];
    document.getElementById('loadBar').style.width = ((i + 1) / msgs.length * 100) + '%';
    i++;
    
    if (i >= msgs.length) {
      clearInterval(interval);
      setTimeout(() => {
        document.getElementById('loading').classList.add('hide');
        document.getElementById('hud').classList.remove('hide');
        document.getElementById('questPanel').classList.remove('hide');
        document.getElementById('controls').classList.remove('hide');
        updateQuests();
        initBabylon();
      }, 500);
    }
  }, 700);
});
</script>
</body>
</html>