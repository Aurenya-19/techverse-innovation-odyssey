<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TechVerse 2077 - Fixed</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; user-select: none; }
body { font-family: Arial, sans-serif; overflow: hidden; background: #000; color: #fff; }

#startScreen { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: linear-gradient(135deg, #667eea, #764ba2); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 10000; }
#startScreen h1 { font-size: 3em; color: #fff; margin-bottom: 20px; }
#startBtn { padding: 20px 60px; font-size: 1.5em; background: #27ae60; border: none; border-radius: 10px; color: #fff; font-weight: bold; cursor: pointer; }
#startBtn:hover { background: #229954; }

#gameScreen { display: none; width: 100vw; height: 100vh; background: #87CEEB; position: relative; }

#hud { position: fixed; top: 10px; left: 10px; background: rgba(0,0,0,0.8); padding: 15px; border-radius: 8px; border: 2px solid #3498db; z-index: 1000; }
#hud h3 { color: #3498db; margin-bottom: 8px; }
.stat { color: #fff; margin: 5px 0; }

#map { position: fixed; bottom: 10px; right: 10px; width: 250px; height: 250px; background: rgba(0,0,0,0.8); border: 2px solid #3498db; border-radius: 8px; z-index: 1000; display: none; }
#mapCanvas { width: 100%; height: 100%; }

#location { position: fixed; top: 10px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.8); padding: 10px 30px; border-radius: 8px; border: 2px solid #3498db; z-index: 1000; }

#prompt { position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); background: #27ae60; padding: 10px 30px; border-radius: 8px; color: #fff; font-weight: bold; z-index: 1000; display: none; }

#notif { position: fixed; top: 100px; left: 50%; transform: translateX(-50%); background: #27ae60; padding: 15px 40px; border-radius: 8px; color: #fff; font-weight: bold; opacity: 0; transition: opacity 0.5s; z-index: 2000; }
#notif.show { opacity: 1; }

#controls { position: fixed; bottom: 10px; left: 10px; background: rgba(0,0,0,0.8); padding: 15px; border-radius: 8px; border: 2px solid #3498db; z-index: 1000; }
.ctrl { color: #fff; margin: 5px 0; font-size: 0.9em; }
.key { background: #3498db; padding: 3px 8px; border-radius: 4px; margin-right: 5px; }
</style>
</head>
<body>

<div id="startScreen">
  <h1>üåü TECHVERSE 2077 üåü</h1>
  <p style="color: #fff; margin-bottom: 20px; font-size: 1.2em;">Simple Working Version - No External Dependencies</p>
  <button id="startBtn">START GAME</button>
</div>

<div id="gameScreen">
  <div id="hud">
    <h3>‚ö° STATUS</h3>
    <div class="stat">Level: <span id="lvl">1</span></div>
    <div class="stat">XP: <span id="xp">0/1000</span></div>
    <div class="stat">Labs: <span id="labs">0/5</span></div>
  </div>
  
  <div id="map">
    <canvas id="mapCanvas"></canvas>
  </div>
  
  <div id="location">üìç <span id="loc">Neo-City 2077</span></div>
  <div id="prompt">Press E to Enter</div>
  <div id="notif"></div>
  
  <div id="controls">
    <div class="ctrl"><span class="key">WASD</span> Move</div>
    <div class="ctrl"><span class="key">MOUSE</span> Drag to Look</div>
    <div class="ctrl"><span class="key">E</span> Interact</div>
    <div class="ctrl"><span class="key">M</span> Map</div>
  </div>
</div>

<script>
console.log('üåü TechVerse 2077 - Simple Version');

const state = {
  lvl: 1,
  xp: 0,
  xpMax: 1000,
  labs: 0,
  playerX: 0,
  playerZ: 250,
  playerAngle: 0,
  insideLab: false,
  mapVisible: false
};

const buildings = [
  { name: 'Robo Lab', x: -100, z: -100, color: '#ff6b6b', icon: 'ü§ñ' },
  { name: 'Car Showroom', x: 0, z: -100, color: '#4ecdc4', icon: 'üöó' },
  { name: 'Mind Upload', x: 100, z: -100, color: '#f38181', icon: 'üß†' },
  { name: 'Quantum Lab', x: -50, z: 100, color: '#9b59b6', icon: '‚öõÔ∏è' },
  { name: 'DNA Lab', x: 50, z: 100, color: '#1abc9c', icon: 'üß¨' }
];

let keys = {};
let mouseDown = false;
let lastMouseX = 0;

document.getElementById('startBtn').addEventListener('click', () => {
  document.getElementById('startScreen').style.display = 'none';
  document.getElementById('gameScreen').style.display = 'block';
  notify('üéÆ Welcome! Use WASD to move, drag mouse to look around!');
  drawCity();
  drawMap();
  gameLoop();
});

document.addEventListener('keydown', e => {
  keys[e.key.toLowerCase()] = true;
  if (e.key.toLowerCase() === 'e') interact();
  if (e.key.toLowerCase() === 'm') toggleMap();
});

document.addEventListener('keyup', e => {
  keys[e.key.toLowerCase()] = false;
});

document.addEventListener('mousedown', e => {
  mouseDown = true;
  lastMouseX = e.clientX;
});

document.addEventListener('mouseup', () => {
  mouseDown = false;
});

document.addEventListener('mousemove', e => {
  if (mouseDown) {
    const deltaX = e.clientX - lastMouseX;
    state.playerAngle += deltaX * 0.003;
    lastMouseX = e.clientX;
  }
});

function drawCity() {
  const screen = document.getElementById('gameScreen');
  screen.innerHTML = `
    <div id="hud">
      <h3>‚ö° STATUS</h3>
      <div class="stat">Level: <span id="lvl">${state.lvl}</span></div>
      <div class="stat">XP: <span id="xp">${state.xp}/${state.xpMax}</span></div>
      <div class="stat">Labs: <span id="labs">${state.labs}/5</span></div>
    </div>
    
    <div id="map" style="display: ${state.mapVisible ? 'block' : 'none'}">
      <canvas id="mapCanvas"></canvas>
    </div>
    
    <div id="location">üìç <span id="loc">${state.insideLab ? 'Inside Lab' : 'Neo-City 2077'}</span></div>
    <div id="prompt" style="display: none;">Press E to Enter</div>
    <div id="notif"></div>
    
    <div id="controls">
      <div class="ctrl"><span class="key">WASD</span> Move</div>
      <div class="ctrl"><span class="key">MOUSE</span> Drag to Look</div>
      <div class="ctrl"><span class="key">E</span> Interact</div>
      <div class="ctrl"><span class="key">M</span> Map</div>
    </div>
    
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center;">
      <h2 style="color: #2c3e50; font-size: 2em; margin-bottom: 20px;">üèôÔ∏è NEO-CITY 2077</h2>
      <p style="color: #34495e; font-size: 1.2em; margin-bottom: 30px;">5 Advanced Research Labs</p>
      <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; max-width: 800px;">
        ${buildings.map(b => `
          <div style="background: ${b.color}; padding: 30px; border-radius: 12px; cursor: pointer; transition: transform 0.3s;" onclick="enterLab('${b.name}')">
            <div style="font-size: 3em; margin-bottom: 10px;">${b.icon}</div>
            <div style="font-size: 1.2em; font-weight: bold; color: #fff;">${b.name}</div>
          </div>
        `).join('')}
      </div>
      <p style="color: #7f8c8d; margin-top: 30px; font-size: 0.9em;">Click on any lab to enter</p>
    </div>
  `;
  
  if (state.mapVisible) drawMap();
}

function drawMap() {
  const canvas = document.getElementById('mapCanvas');
  if (!canvas) return;
  
  const ctx = canvas.getContext('2d');
  canvas.width = 250;
  canvas.height = 250;
  
  ctx.fillStyle = '#1a1a1a';
  ctx.fillRect(0, 0, 250, 250);
  
  // Grid
  ctx.strokeStyle = '#333';
  ctx.lineWidth = 1;
  for (let i = 0; i <= 5; i++) {
    ctx.beginPath();
    ctx.moveTo(i * 50, 0);
    ctx.lineTo(i * 50, 250);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(0, i * 50);
    ctx.lineTo(250, i * 50);
    ctx.stroke();
  }
  
  // Buildings
  buildings.forEach(b => {
    const x = (b.x + 150) / 300 * 250;
    const y = (b.z + 150) / 300 * 250;
    
    ctx.fillStyle = b.color;
    ctx.fillRect(x - 5, y - 5, 10, 10);
    
    ctx.fillStyle = '#fff';
    ctx.font = '14px Arial';
    ctx.textAlign = 'center';
    ctx.fillText(b.icon, x, y + 5);
  });
  
  // Player
  const px = (state.playerX + 150) / 300 * 250;
  const py = (state.playerZ + 150) / 300 * 250;
  ctx.fillStyle = '#27ae60';
  ctx.beginPath();
  ctx.arc(px, py, 5, 0, Math.PI * 2);
  ctx.fill();
}

function toggleMap() {
  state.mapVisible = !state.mapVisible;
  drawCity();
}

function interact() {
  // Check if near any building
  buildings.forEach(b => {
    const dist = Math.sqrt((state.playerX - b.x) ** 2 + (state.playerZ - b.z) ** 2);
    if (dist < 50) {
      enterLab(b.name);
    }
  });
}

function enterLab(name) {
  state.insideLab = true;
  state.labs++;
  
  const screen = document.getElementById('gameScreen');
  screen.innerHTML = `
    <div id="hud">
      <h3>‚ö° STATUS</h3>
      <div class="stat">Level: <span id="lvl">${state.lvl}</span></div>
      <div class="stat">XP: <span id="xp">${state.xp}/${state.xpMax}</span></div>
      <div class="stat">Labs: <span id="labs">${state.labs}/5</span></div>
    </div>
    
    <div id="location">üî¨ <span id="loc">${name}</span></div>
    <div id="notif"></div>
    
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; max-width: 800px;">
      <h2 style="color: #2c3e50; font-size: 2.5em; margin-bottom: 20px;">${name}</h2>
      <p style="color: #34495e; font-size: 1.2em; margin-bottom: 30px;">Advanced Research Facility</p>
      
      <div style="background: #ecf0f1; padding: 40px; border-radius: 12px; margin-bottom: 20px;">
        <h3 style="color: #2c3e50; margin-bottom: 20px;">Available Gadgets</h3>
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
          ${[1,2,3,4,5,6].map(i => `
            <div style="background: #3498db; padding: 20px; border-radius: 8px; cursor: pointer; color: #fff;" onclick="useGadget(${i})">
              <div style="font-size: 2em; margin-bottom: 10px;">üî¨</div>
              <div>Gadget ${i}</div>
            </div>
          `).join('')}
        </div>
      </div>
      
      <button onclick="exitLab()" style="padding: 15px 40px; font-size: 1.2em; background: #e74c3c; border: none; border-radius: 8px; color: #fff; font-weight: bold; cursor: pointer;">
        EXIT LAB
      </button>
    </div>
  `;
  
  notify(`üö™ Entered ${name}!`);
}

function useGadget(id) {
  state.xp += 120;
  
  if (state.xp >= state.xpMax) {
    state.xp -= state.xpMax;
    state.lvl++;
    state.xpMax = Math.floor(state.xpMax * 1.5);
    notify(`üéâ LEVEL UP! Now Level ${state.lvl}!`);
  } else {
    notify(`‚úì Gadget ${id} used! +120 XP`);
  }
  
  document.getElementById('lvl').textContent = state.lvl;
  document.getElementById('xp').textContent = `${state.xp}/${state.xpMax}`;
}

function exitLab() {
  state.insideLab = false;
  notify('üö™ Exited lab!');
  drawCity();
}

function notify(msg) {
  const n = document.getElementById('notif');
  if (!n) return;
  n.textContent = msg;
  n.classList.add('show');
  setTimeout(() => n.classList.remove('show'), 3000);
}

function gameLoop() {
  // Movement
  const speed = 2;
  if (keys['w']) {
    state.playerX += Math.sin(state.playerAngle) * speed;
    state.playerZ += Math.cos(state.playerAngle) * speed;
  }
  if (keys['s']) {
    state.playerX -= Math.sin(state.playerAngle) * speed;
    state.playerZ -= Math.cos(state.playerAngle) * speed;
  }
  if (keys['a']) {
    state.playerX += Math.cos(state.playerAngle) * speed;
    state.playerZ -= Math.sin(state.playerAngle) * speed;
  }
  if (keys['d']) {
    state.playerX -= Math.cos(state.playerAngle) * speed;
    state.playerZ += Math.sin(state.playerAngle) * speed;
  }
  
  // Check proximity to buildings
  let nearBuilding = false;
  buildings.forEach(b => {
    const dist = Math.sqrt((state.playerX - b.x) ** 2 + (state.playerZ - b.z) ** 2);
    if (dist < 50) {
      nearBuilding = true;
    }
  });
  
  const prompt = document.getElementById('prompt');
  if (prompt) {
    prompt.style.display = nearBuilding && !state.insideLab ? 'block' : 'none';
  }
  
  if (state.mapVisible) drawMap();
  
  requestAnimationFrame(gameLoop);
}

console.log('‚úì Game Ready!');
</script>
</body>
</html>